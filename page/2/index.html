<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="https://github.com/itgoyo">
  <title>itgoyo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="talk is cheap,show me the girl.">
<meta property="og:type" content="website">
<meta property="og:title" content="itgoyo">
<meta property="og:url" content="https://github.com/itgoyo/page/2/index.html">
<meta property="og:site_name" content="itgoyo">
<meta property="og:description" content="talk is cheap,show me the girl.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="itgoyo">
<meta name="twitter:description" content="talk is cheap,show me the girl.">
  
    <link rel="alternative" href="/atom.xml" title="itgoyo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/main.d221b8.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c16d3c10c9ea6c6fe749d9926d52b0d6";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=300 height=110 src="//music.163.com/outchain/player?type=0&id=120897804&auto=0&height=90"></iframe>
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="https://cn.gravatar.com/userimage/109230546/898311ab23eb215d186762d5e93e773d.jpg?size=200" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">itgoyo</a></h1>
		</hgroup>
		
		<p class="header-subtitle">talk is cheap,show me the girl.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/itgoyo" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="http://weibo.com/5792513777/profile?topnav=1&wvr=6&is_all=1" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
					<a class="mail" target="_blank" href="mailto:itgoyo@gmail.com" title="mail"><i class="icon-mail"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="https://cn.gravatar.com/userimage/109230546/898311ab23eb215d186762d5e93e773d.jpg?size=200" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">itgoyo</h1>
			</hgroup>
			
			<p class="header-subtitle"><i class="icon icon-quo-left"></i>talk is cheap,show me the girl.<i class="icon icon-quo-right"></i></p>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/itgoyo" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/5792513777/profile?topnav=1&wvr=6&is_all=1" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
						<a class="mail" target="_blank" href="mailto:itgoyo@gmail.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-Android卸载反馈" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/Android卸载反馈/">Android卸载反馈</a>
    </h1>
  

        
        <a href="/2015/01/01/Android卸载反馈/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Android卸载反馈"><a href="#Android卸载反馈" class="headerlink" title="Android卸载反馈"></a>Android卸载反馈</h1><p>最初记得是在360安全卫士中出现的，在手机上卸载他的应用之后浏览器就会弹出一个反馈页面，让用户进行反馈，感觉这种功能对于产品改进特别有帮助。<br>但是仔细一想该怎么去实现却犯愁了，最开始想这也简单啊，不就是监听下自身被卸载就可以了，应该系统会有卸载的广播，可惜没有。甚至其他的一些<br>方法也是不行的，因为你程序都被卸载了，你的代码怎么会执行呢？皮之不存，毛将焉附。那360是怎样实现的呢？说句真心话360做的产品还是非常有创新<br>的，虽然有些时候他会损坏用户的利益，不过但从技术方面，着实让人信服。</p>
<p>既然<code>Java</code>实现不了，那就得考虑下其他的了，自然最先想到的就是<code>JNI</code>了，可惜<code>C</code>的部分不懂，上网搜了很多资料和介绍，找得到可以通过一下方式实现:   </p>
<ul>
<li><p>通过<code>c</code>中的<code>fork</code>方法来复制一个子进程。复制出来的子进程在父进程被销毁后，仍然可以存在。<br>  <code>pid_t fpid = fork()</code>被调用前，就一个进程执行该段代码，这条语句执行之后，就会有两个进程执行该代码，两个进程执行没有固定先后顺序，只要看<br>  系统调度策略，<code>fork()</code>函数的特别之处在于调用一次会返回两次结果：   </p>
<pre><code>- 返回值大于0，当前是父进程。
- 返回0，当前是子进程。
- 返回小于0的负值。(出错了，可能是内存不足或者是进程数已经达到系统最大值)
</code></pre></li>
<li><p><code>fork</code>出子进程后让子进程一直去监听<code>/data/data/packageName</code>是否存在，如果不存在了，那就说明程序被卸载了，但是这样一直去轮训判断肯定会浪费<br>  系统资源的，当然也会更加费电，对用户来讲肯定是有损害的。所以这种技术最好也不好用，不然大家的手机以后还能了得。万恶的产品。</p>
</li>
<li><p>得到程序被卸载之后弹出浏览器打开指定反馈页面。这就要用到<code>am</code>命令了，最早知道这个命令是在开发<code>TV</code>版的时候，遥控器找不到了，程序安装后无法<br> 打开了，用该命令就不怕了，哈哈。但是在<code>c</code>中怎么执行<code>am</code>命令呢？这就要用到<code>execlp()</code>函数，该函数就是<code>c</code>中执行系统命令的函数。</p>
</li>
</ul>
<p>好了，主要的内容上面都分析完了，下面上代码。</p>
<ul>
<li><p><code>Java</code>层定义<code>natvie</code>方法。   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"@@@"</span>;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(R.layout.activity_main);</div><div class="line">		String packageDir = <span class="string">"/data/data/"</span> + getPackageName();</div><div class="line">		initUninstallFeedback(packageDir, Build.VERSION.SDK_INT);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">initUninstallFeedback</span><span class="params">(String packagePath, <span class="keyword">int</span> sdkVersion)</span></span>;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> &#123;</div><div class="line">		System.loadLibrary(<span class="string">"uninstall_feedback"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>创建jni目录，增加<code>Android.mk</code>以及<code>uninstall_feedback.c</code>文件。<br><code>Android.mk</code>的内容:</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">LOCAL_PATH := $(call my-dir)</div><div class="line"></div><div class="line">include $(CLEAR_VARS)</div><div class="line"></div><div class="line">LOCAL_MODULE    := uninstall_feedback</div><div class="line">LOCAL_SRC_FILES := uninstall_feedback.c</div><div class="line"></div><div class="line">LOCAL_C_INCLUDES := $(LOCAL_PATH)/include</div><div class="line">LOCAL_LDLIBS += -L$(SYSROOT)/usr/lib -llog</div><div class="line"></div><div class="line">include $(BUILD_SHARED_LIBRARY)</div></pre></td></tr></table></figure>
<p><code>uninstall_feedback.c</code>的实现: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 将Java中的String转换成c中的char字符串</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">char</span>* <span class="title">Jstring2CStr</span><span class="params">(JNIEnv* env, jstring jstr)</span> </span>&#123;</div><div class="line">	<span class="keyword">char</span>* rtn = <span class="literal">NULL</span>;</div><div class="line">	jclass clsstring = (*env)-&gt;FindClass(env, <span class="string">"java/lang/String"</span>); <span class="comment">//String</span></div><div class="line">	jstring strencode = (*env)-&gt;NewStringUTF(env, <span class="string">"GB2312"</span>); <span class="comment">// 得到一个java字符串 "GB2312"</span></div><div class="line">	jmethodID mid = (*env)-&gt;GetMethodID(env, clsstring, <span class="string">"getBytes"</span>,</div><div class="line">			<span class="string">"(Ljava/lang/String;)[B"</span>); <span class="comment">//[ String.getBytes("gb2312");</span></div><div class="line">	jbyteArray barr = (jbyteArray)(*env)-&gt;CallObjectMethod(env, jstr, mid,</div><div class="line">			strencode); <span class="comment">// String .getByte("GB2312");</span></div><div class="line">	jsize alen = (*env)-&gt;GetArrayLength(env, barr); <span class="comment">// byte数组的长度</span></div><div class="line">	jbyte* ba = (*env)-&gt;GetByteArrayElements(env, barr, JNI_FALSE);</div><div class="line">	<span class="keyword">if</span> (alen &gt; <span class="number">0</span>) &#123;</div><div class="line">		rtn = (<span class="keyword">char</span>*) <span class="built_in">malloc</span>(alen + <span class="number">1</span>); <span class="comment">//""</span></div><div class="line">		<span class="built_in">memcpy</span>(rtn, ba, alen);</div><div class="line">		rtn[alen] = <span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	(*env)-&gt;ReleaseByteArrayElements(env, barr, ba, <span class="number">0</span>); <span class="comment">//</span></div><div class="line">	<span class="keyword">return</span> rtn;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Java_com_charon_uninstallfeedback_MainActivity_initUninstallFeedback</span><span class="params">(</span></span></div><div class="line">		JNIEnv* env, jobject thiz, jstring packageDir, jint sdkVersion) &#123;</div><div class="line"></div><div class="line">	<span class="keyword">char</span> * pd = Jstring2CStr(env, packageDir);</div><div class="line"></div><div class="line">	<span class="comment">//fork子进程，以执行轮询任务</span></div><div class="line">	<span class="keyword">pid_t</span> pid = fork();</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (pid &lt; <span class="number">0</span>) &#123;</div><div class="line">		<span class="comment">// fork失败了</span></div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</div><div class="line">		<span class="comment">// 可以一直采用一直判断文件是否存在的方式去判断，但是这样效率稍低，下面使用监听的方式，死循环，每个一秒判断一次，这样太浪费资源了。</span></div><div class="line">		<span class="keyword">int</span> check = <span class="number">1</span>;</div><div class="line">		<span class="keyword">while</span> (check) &#123;</div><div class="line">			FILE* file = fopen(pd, <span class="string">"rt"</span>);</div><div class="line">			<span class="keyword">if</span> (file == <span class="literal">NULL</span>) &#123;</div><div class="line">				<span class="keyword">if</span> (sdkVersion &gt;= <span class="number">17</span>) &#123;</div><div class="line">					<span class="comment">// Android4.2系统之后支持多用户操作，所以得指定用户</span></div><div class="line">					execlp(<span class="string">"am"</span>, <span class="string">"am"</span>, <span class="string">"start"</span>, <span class="string">"--user"</span>, <span class="string">"0"</span>, <span class="string">"-a"</span>,</div><div class="line">							<span class="string">"android.intent.action.VIEW"</span>, <span class="string">"-d"</span>,</div><div class="line">							<span class="string">"http://shouji.360.cn/web/uninstall/uninstall.html"</span>,</div><div class="line">							(<span class="keyword">char</span>*) <span class="literal">NULL</span>);</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					<span class="comment">// Android4.2以前的版本无需指定用户</span></div><div class="line">					execlp(<span class="string">"am"</span>, <span class="string">"am"</span>, <span class="string">"start"</span>, <span class="string">"-a"</span>,</div><div class="line">						<span class="string">"android.intent.action.VIEW"</span>, <span class="string">"-d"</span>,</div><div class="line">							<span class="string">"http://shouji.360.cn/web/uninstall/uninstall.html"</span>,</div><div class="line">							(<span class="keyword">char</span>*) <span class="literal">NULL</span>);</div><div class="line">				&#125;</div><div class="line">				check = <span class="number">0</span>;</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">			&#125;</div><div class="line">			sleep(<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>编译so文件。<code>Windows</code>下要用<code>cygwin</code>来操作。<br>上面的介绍是在<code>Eclipse</code>中进行的，用<code>ndk-build</code>命令来编译<code>so</code>。具体请看之前写的<code>JNI基础</code>这篇文章。</li>
</ul>
<p>有关如何在<code>Android Stuido</code>中进行<code>ndk</code>开发请看另一篇文章。</p>
<hr>
<ul>
<li>邮箱 ：itgoyo@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/Android卸载反馈/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Android开发不申请权限来使用对应功能" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/Android开发不申请权限来使用对应功能/">Android开发不申请权限来使用对应功能</a>
    </h1>
  

        
        <a href="/2015/01/01/Android开发不申请权限来使用对应功能/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Android开发不申请权限来使用对应功能"><a href="#Android开发不申请权限来使用对应功能" class="headerlink" title="Android开发不申请权限来使用对应功能"></a>Android开发不申请权限来使用对应功能</h1><p>从用户角度来说很难获取到正确的<code>android</code>权限。通常你只需要做一些很基础的事(例如编辑一个联系人)但实际你申请的权限却远远比这更强大(例如可以获取到所有的联系人明细等)。</p>
<p>这样能很容易的理解到用户会怀疑到你的应用。如果你的应用不是开源的，那他们就没有方法来验证你会不会下载所有的联系人数据并上传到服务器。及时你去解释为什么需要这个权限，但是人们不会相信你。原来我会选择不去使用这些敏感的权限来防止用户产生不信任。(当然很多应用他们申请权限只是为了后台获取你的联系人数据上传- -!以及之前被爆的某宝使用摄像头拍照的问题)</p>
<p>这就是说，有一件事在困扰着我，<strong>如何能在做一些操作时不去申请权限。</strong></p>
<p>打个比方说:<code>android.permission.CALL_PHONE</code>这个权限。你需要它来在应用中拨打电话，是吗？这就是你怎么去实现拨号的吗？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_CALL);</div><div class="line">intent.setData(Uri.parse(<span class="string">"tel:1234567890"</span>))</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p><strong>错！</strong>，你通过这段代码需要该权限的原因是因为你可以在任何时间在不需要用户操作的情况下打电话。也就是说如果我的应用申请了这个权限，我可以在你不知情的情况下每天凌晨三点去拨打骚扰电话。</p>
<p>正确的方式是使用<code>ACTION_VIEW</code>或者<code>ACTION_DIAL</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_DIAL);</div><div class="line">intent.setData(Uri.parse(<span class="string">"tel:1234567890"</span>))</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p><strong>这个问题的完美解决方案就是不需要申请权限了。</strong>原因就是你不是直接拨号，而是用指定的号码调起拨号器，仍然需要用户点击”拨号”来开始打电话。老实的说，这样让人感觉更好。</p>
<p>简单的说就是如果我想要的操作不是让用户在应用内点击某个按钮就直接开始拨打电话，而是让用户点击在应用内点击某个按钮是我们去调起拨号程序，并且显示指定号码，让用户在拨号器中点击拨号后再开始拨打电话。这样的话我们就完全不用申请拨号权限了。</p>
<p>另一个例子: 我想获取某一个联系人的号码，你可能会想这需要申请获取所有联系人的权限。这是错的！。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_PICK);</div><div class="line">intent.setType(StructuredPostal.CONTENT_TYPE);</div><div class="line">startActivityForResult(intent, <span class="number">1</span>);</div></pre></td></tr></table></figure></p>
<p>我们可以使用上面的代码，来启动联系人管理器，让用户来选择某一个联系人。这样不仅是不需要申请任何权限，也不需要提供任何联系人相关的<code>UI</code>。这样也能完全保证你选择联系人时的体验。</p>
<p><code>Android</code>系统最酷的部分之一就是<code>Intent</code>系统，这意味着我不需要自己来实现所有的东西。应用可以注册处理它所擅长的指定数据，像电话号码、短信或者联系人。如果这些都要自己在一个应用中去实现，那这将会是很大的工作量，也会让应用变得臃肿。</p>
<p><code>Android</code>系统的另一个优势就是你可以使用其他应用申请的权限，而不用自己申请。这样才保证了上面的情况。拨号器需要申请拨打电话的权限，我只需要一个能调起拨号器的<code>Intent</code>就好了。用户信任拨号器拨打电话，而不是我们的应用。他们无论如何都宁愿使用系统的拨号器。</p>
<p>写这篇文章的意义是<strong>在你想要申请一个权限的时候，你需要至少看看<a href="https://developer.android.com/reference/android/content/Intent.html" target="_blank" rel="external">Intent的官方文档</a>看能否请求另外一个应用来帮我们做这些操作。</strong>如果想要深入的研究，可以学习下<a href="https://developer.android.com/guide/topics/security/permissions.html" target="_blank" rel="external">关于权限的详细介绍</a>，这里面包含了很多精细的权限。</p>
<p>使用更少的权限可以不但可以让用户更加信任你，而且可以让用户有一个更好的体验，因为他们仍然在使用他们所期望的应用。</p>
<ol>
<li>遗憾的是，不是一个真实的号码。</li>
<li>不幸的是，<code>Intent</code>系统的属性也建立了<a href="http://css.csail.mit.edu/6.858/2012/projects/ocderby-dennisw-kcasteel.pdf" target="_blank" rel="external">可能会被滥用的漏洞</a>，但你也不会写一个滥用的应用，是吗？</li>
</ol>
<ul>
<li>(译)<a href="http://blog.danlew.net/2014/11/26/i-dont-need-your-permission/" target="_blank" rel="external">感谢Dan Lew</a></li>
</ul>
<hr>
<ul>
<li>邮箱 ：itgoyo@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/Android开发不申请权限来使用对应功能/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Android开发工具及类库" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/Android开发工具及类库/">Android开发工具及类库</a>
    </h1>
  

        
        <a href="/2015/01/01/Android开发工具及类库/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Android开发工具及类库"><a href="#Android开发工具及类库" class="headerlink" title="Android开发工具及类库"></a>Android开发工具及类库</h1><p>在项目开发过程中，总有一些必要的工具和类库。下面就简单介绍下我常用的一些(还在用<code>Eclipse</code>的请无视)。      </p>
<ol>
<li><p><a href="https://android.googlesource.com/platform/frameworks/volley" target="_blank" rel="external">volley</a><br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/volley.png?raw=true" alt="image"><br>在<code>Google I/0 2013</code>中发布了<code>Volley</code>.<code>Volley</code>是<code>Android</code>平台上的网络通信库，能使网络通信更快，更简单，更健壮。<br>这是<code>Volley</code>名称的由来:<code>a burst or emission of many things or a large amount at once</code>.<code>Volley</code>特别适合数据量不大但是通信频繁的场景。<br><code>Github</code>上面已经有大神做了镜像，使用更方便有木有。<a href="https://github.com/mcxiaoke/android-volley">Volley On Github</a>                     </p>
</li>
<li><p><a href="https://code.google.com/p/google-gson/" target="_blank" rel="external">Gson</a><br><code>Json</code>转换神器。</p>
</li>
<li><p><a href="https://github.com/zzz40500/GsonFormat">GsonFormat</a><br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/GsonFormat.gif?raw=true" alt="image"><br>既然用了<code>Gson</code>怎么能少了该神器呢？</p>
</li>
<li><p><a href="https://github.com/avast/android-butterknife-zelezny">android-butterknife-zelezny</a><br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/zelezny_animated.gif?raw=true" alt="image"><br>使用<a href="https://github.com/JakeWharton/butterknife">butterknife</a>制作的<code>Android Studio/IDEA</code>插件。非常方便有木有。</p>
</li>
<li><p><a href="https://github.com/inmite/android-selector-chapek">android-selector-chapek</a><br><code>selector</code>写起来是不是很麻烦？以后让<code>UI</code>规范化命名，然后就没有然后了。<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/select_folder.png?raw=true" alt="image"><br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/select_option.png?raw=true" alt="image"><br>接下来你就会在<code>drawable</code>目录发现对应的<code>selector</code>文件。           </p>
</li>
<li><p><a href="https://github.com/square/leakcanary">leakcanary</a><br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/screenshot.png?raw=true" alt="image"><br>内存泄漏你怕不怕？         </p>
</li>
<li><p><a href="https://github.com/facebook/fresco">fresco</a><br>怎么能少了对图片的处理呢？<code>Fracebook</code>出品。更快、更强、更方便。       </p>
</li>
<li><p><a href="https://github.com/KeepSafe/android-resource-remover">android-resource-remover</a><br> 开发过程中可能会经常遇到需求的变更，时间长了，项目中的无用资源就会越来越多。 虽然在<code>Gradle</code>中支持相应的配置来去除无用资源: </p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">buildTypes &#123;</div><div class="line">       debug &#123;</div><div class="line">           minifyEnabled false</div><div class="line">           zipAlignEnabled false</div><div class="line">           shrinkResources false</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       release &#123;</div><div class="line">           zipAlignEnabled true</div><div class="line">           // remove unused resources</div><div class="line">           shrinkResources true</div><div class="line">           minifyEnabled true</div><div class="line">           proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'</div><div class="line">           signingConfig signingConfigs.release</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>但是这只是在打包的时候不会打进去无用的资源，但是这些资源还是会在工程中。
那我们怎么能快速的移除掉这些无用资源呢？答案也很简单，就是使用`lint`检查出无用的资源后用工具删除，这个工具就是`android-resource-remover`。 
因为它是一个`python`脚本，所以如果不懂`python`的话使用起来会比较麻烦，下面就介绍一下具体的使用方法:            
- 下载并安装`Python 2.x`版本
    去[Python](https://www.python.org/)下载后即可，这里要下载2.x版本，因为3.x版本对语法做了很多改动，可能会不兼容，下载完成后安装就可。安装完成后将安装路径加入到`Path`中。如`D:\Python;`。
- 安装`android-resource-remover`     
    在命令行输入下面的命令`pip install android-resource-remover`。 这里有些电脑可能会提示错误，是因为没有安装`pip`导致的，具体可以看[pip](https://pip.pypa.io/en/latest/installing.html)找到安装的方法。上面介绍了要下载`get-pip.py`后执行`python get-pip.py`就能安装了。
- 将`D:\Python\Scripts`添加到`Path`中。
- 将`lint`命令添加到`Path`中，`D:\android-sdk-windows\tools`.
- 在`Studio`右侧的`Gradle`窗口中执行`lint`任务。 这样就会在`app/build/outputs`下生成`lint-results.xml`文件。下一步清理的时候需要使用`lint-results.xml`文件。               
    ![Image](https://raw.githubusercontent.com/CharonChui/Pictures/master/lint.png?raw=true)    
- 进入到`Android Studio`中的具体项目中执行`./gradlew clean`后再执行`./gradlew lint &amp;&amp; android-resource-remover --xml app/build/outputs/lint-results.xml`
</code></pre><ol>
<li><a href="https://github.com/facebook/stetho">stetho</a><br> <code>facebook</code>出品。快速查看布局、数据库、网络请求。实在不能再方便了。   </li>
<li><a href="https://github.com/ReactiveX/RxJava">RxJava</a><br>用了后你会爱上它。</li>
<li><a href="https://github.com/square/retrofit">Retrofilt</a><br><code>Square</code>出品。大神<code>JakeWharton</code>主导出品的网络请求框架。内部结合<code>OkHttp</code>。结合<code>RxJava</code>使用非常方便。   </li>
<li><a href="https://github.com/googlesamples/android-architecture">android-architecture</a><br>放到这里可能不太合适，因为它并不是工具和类库，而是<code>Google</code>官方发布的<code>Android</code>架构示例。非常值得参考。  </li>
<li><a href="https://github.com/pedrovgs/AndroidWiFiADB">AndroidWiFiADB</a><br>还在为数据线不够用而烦恼嘛?</li>
</ol>
<hr>
<ul>
<li>邮箱 ：itgoyo@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/Android开发工具及类库/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-ApplicationId vs PackageName" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/ApplicationId vs PackageName/">ApplicationId vs PackageName</a>
    </h1>
  

        
        <a href="/2015/01/01/ApplicationId vs PackageName/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ApplicationId-vs-PackageName"><a href="#ApplicationId-vs-PackageName" class="headerlink" title="ApplicationId vs PackageName"></a>ApplicationId vs PackageName</h1><p>曾几何时，自从转入<code>Studio</code>阵营后就发现多了个<code>applicationId &quot;com.xx.xxx&quot;</code>，虽然知道肯定会有区别，但是我却没有仔细去看，只想着把它和<code>packageName</code>设置成相同即可(原谅我的懒惰- -!)。         </p>
<p>直到今天在官网看<code>Gradle</code>使用时，终于忍不住要搞明白它俩的区别。         </p>
<p>在<code>Android</code>官方文档中有一句是这样描述<code>applicationId</code>的:<code>applicationId : the effective packageName</code>，真是言简意赅，那既然<code>applicationId</code>是有效的包明了，<code>packageName</code>算啥？     </p>
<p>所有<code>Android</code>应用都有一个包名。包名在设备上能唯一的标示一个应用，它在<code>Google Play</code>应用商店中也是唯一的。这就意味着一旦你使用一个包名发布应用后，你就永 远不能改变它的包名；如果你改了包名就会导致你的应用被认为是一个新的应用，并且已经使用你之前应用的用户将不会看到作为更新的新应用包。          </p>
<p>之前的<code>Android Gradle</code>构建系统中，应用的包名是由你的<code>manifest</code>文件中的根元素中的<code>package</code>属性定义的:       </p>
<p><code>AndroidManifest.xml:</code>          </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    package=&quot;com.example.my.app&quot;</div><div class="line">    android:versionCode=&quot;1&quot;</div><div class="line">    android:versionName=&quot;1.0&quot; &gt;</div></pre></td></tr></table></figure>
<p>然而，这里定义的包也有第二个目的：就是被用来命名你的<code>R</code>资源类(以及解析任何与<code>Activities</code>相关的类名)的包。在上面的示例中，生成的<code>R</code>类就是<code>com.example.my.app.R</code>，所以如果你在其他的包中想引用资源，就需要导入<code>com.example.my.app.R</code>。      </p>
<p>伴随着新的<code>Android Gradle</code>构建系统，你可以很简单的为你的应用构建多个不同的版本；例如，你可以同时为你的应用构建一个免费版本和一个专业版(使用<code>flavors</code>)，并且他们应该在<code>Google Play</code>商店中有不同的包，这样才能让他们可以被单独安装和购买，同时安装两个，等等。同样的你也可能同时为你的应用构建<code>debug</code>版、<code>alpha</code>版和<code>beta</code>版(使用<code>build types</code>)，这些也可以同样使用不同的包名。    </p>
<p>在这同时，你在代码中导入的<code>R</code>类必须一直保持一直；在为应用构建不同的版本时<code>.java</code>源文件都不应该发生变化。</p>
<p>因此,我们解耦了<code>package name</code>的两种用法:       </p>
<ul>
<li>在生成的<code>.apk</code>中的<code>manifest</code>文件中使用的最终的包名以及在你的设备和<code>Google Play</code>商店中用来标示你的包名叫做<code>application id</code>的值。</li>
<li>在源代码中指向<code>R</code>类的包名以及在解析任何与<code>activity/service</code>注册相关的包名继续叫做<code>package name</code>。</li>
</ul>
<p>可以在<code>gradle</code>文件中像如下指定<code>application id</code>:  </p>
<p><code>app/build.gradle:</code>         </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">apply plugin: &apos;com.android.application&apos;</div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion 19</div><div class="line">    buildToolsVersion &quot;19.1&quot;</div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        applicationId &quot;com.example.my.app&quot;</div><div class="line">        minSdkVersion 15</div><div class="line">        targetSdkVersion 19</div><div class="line">        versionCode 1</div><div class="line">        versionName &quot;1.0&quot;</div><div class="line">    &#125;</div><div class="line">    ...</div></pre></td></tr></table></figure>
<p>像之前一样，你需要在<code>Manifest</code>文件中指定你在代码中使用的’package name’，像上面<code>AndroidManifest.xml</code>的例子。<br><strong><em>下面进入关键部分了：</em></strong>当你按照上面的方式做完后，这两个包就是相互独立的了。你现在可以很简单的重构你的代码-通过修改<code>Manifest</code>中的包名来修改在你的<code>activitise</code>和<code>services</code>中使用的包和在重构你在代码中的引用声明。这不会影响你应用的最终<code>id</code>，也就是在<code>Gradle</code>文件中的<code>applicationId</code>。       </p>
<p>你可以通过以下<code>Gradle DSL</code>方法为应用的<code>flavors</code>和<code>build types</code>指定不同的<code>applicationId</code>:       </p>
<p><code>app/buid.gradle:</code>      </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">productFlavors &#123;</div><div class="line">    pro &#123;</div><div class="line">        applicationId = &quot;com.example.my.pkg.pro&quot;</div><div class="line">    &#125;</div><div class="line">    free &#123;</div><div class="line">        applicationId = &quot;com.example.my.pkg.free&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">buildTypes &#123;</div><div class="line">    debug &#123;</div><div class="line">        applicationIdSuffix &quot;.debug&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">....</div></pre></td></tr></table></figure>
<p>(在<code>Android Studio</code>中你也可以通过图形化的<code>Project Structure</code>的对话框来更改上面所有的配置)</p>
<p><strong><em>注意:</em></strong>为了兼容性，如果你在<code>build.gradle</code>文件中没有定义<code>applicationId</code> ，那<code>applicationId</code>就是与<code>AndroidManifest.xml</code>中配置的包名相同的默认值。在这种情况下，这两者显然脱不了干系，如果你试图重构代码中的包就将会导致同时会改变你应用程序的<code>id</code>！在<code>Android Studio</code>中新创建的项目都是同时指定他们俩。     </p>
<p><strong><em>注意2:</em></strong><code>package name</code>必须在默认的<code>AndroidManifest.xml</code>文件中指定。如果有多个<code>manifest</code>文件(例如对每个<code>flavor</code>制定一个<code>manifest</code>或者每个<code>build type</code>制定一个<code>manifest</code>)时，<code>package name</code>是可选的，但是如果你指定的话，它必须与主<code>manifest</code>中指定的<code>pakcage</code>相同。</p>
<hr>
<ul>
<li>邮箱 ：charon.chui@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/ApplicationId vs PackageName/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Android启动模式详解" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/Android启动模式详解/">Android启动模式详解</a>
    </h1>
  

        
        <a href="/2015/01/01/Android启动模式详解/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Android启动模式详解"><a href="#Android启动模式详解" class="headerlink" title="Android启动模式详解"></a>Android启动模式详解</h1><ul>
<li>standard<br>  默认模式。在该模式下，<code>Activity</code>可以拥有多个实例，并且这些实例既可以位于同一个task，也可以位于不同的task。每次都会新创建。</li>
<li>singleTop<br>  该模式下，在同一个<code>task</code>中，如果存在该<code>Activity</code>的实例，并且该<code>Activity</code>实例位于栈顶则不会创建该<code>Activity</code>的示例,而仅仅只是调用<code>Activity</code>的<code>onNewIntent()</code>。否则的话，则新建该<code>Activity</code>的实例，并将其置于栈顶。</li>
<li>singleTask<br>  顾名思义，只容许有一个包含该<code>Activity</code>实例的<code>task</code>存在！<br>  在<code>android</code>浏览器<code>browser</code>中，<code>BrowserActivity</code>的<code>launcherMode=&quot;singleTask&quot;</code>，因为<code>browser</code>不断地启动自己，所以要求这个栈中保持只能有一个自己的实例，<code>browser</code>上网的时候，<br>  遇到播放视频的链接，就会通过隐式<code>intent</code>方式跳转找<code>Gallery3D</code>中的<code>MovieView</code>这个类来播放视频，这时候如果你点击<code>home</code>键，再点击<code>browser</code>，你会发现<code>MovieView</code>这个类已经销毁不存在了，<br>  而不会像保存这个<code>MovieView</code>的类对象，给客户带来的用户体验特别的不好。就像别人总结的<code>singleTask</code>模式的<code>Activity</code>不管是位于栈顶还是栈底，再次运行这个<code>Activity</code>时，都会<code>destory</code>掉它上面的<code>Activity</code>来保证整个栈中只有一个自己。<br>  下面是官方文档中的介绍:<br>  <code>The system creates a new task and instantiates the activity at the root of the new task. However, if an instance of the activity already exists in a separate task, the system routes the intent to the existing 
  instance through a call to its onNewIntent() method, rather than creating a new instance. Only one instance of the activity can exist at a time.</code><br>  以<code>singleTask</code>方式启动的<code>Activity</code>，全局只有唯一个实例存在，因此，当我们第一次启动这个<code>Activity</code>时，系统便会创建一个新的任务栈，并且初始化一个<code>Activity</code>实例，放在新任务栈的底部，如果下次再启动这个<code>Activity</code>时，<br>  系统发现已经存在这样的<code>Activity</code>实例，就会调用这个<code>Activity</code>实例的<code>onNewIntent</code>方法，从而把它激活起来。从这句话就可以推断出，以<code>singleTask</code>方式启动的<code>Activity</code>总是属于一个任务栈的根<code>Activity</code>。<br>  下面我们看一下示例图:　<br>  <img src="https://github.com/CharonChui/Pictures/blob/master/singletask.gif?raw=true" alt="image"><br>   坑爹啊！有木有！前面刚说<code>singleTask</code>会在新的任务中运行，并且位于任务堆栈的底部，这里在<code>Task B</code>中，一个赤裸裸的带着<code>singleTask</code>标签的箭头无情地指向<code>Task B</code>堆栈顶端的<code>Activity Y</code>，什么鬼？<br>这其实是和<code>taskAffinity</code>有关，在将要启动时，系统会根据要启动的<code>Activity</code>的<code>taskAffinity</code>属性值在系统中查找这样的一个<code>Task</code>：<code>Task</code>的<code>affinity</code>属性值与即将要启动的<code>Activity</code>的<code>taskAffinity</code>属性值一致。如果存在，<br>就返回这个<code>Task</code>堆栈顶端的<code>Activity</code>回去，不重新创建任务栈了，再去启动另外一个<code>singletask</code>的<code>activity</code>时就会在跟它有相同<code>taskAffinity</code>的任务中启动，并且位于这个任务的堆栈顶端，于是，前面那个图中，<br>就会出现一个带着<code>singleTask</code>标签的箭头指向一个任务堆栈顶端的<code>Activity Y</code>了。在上面的<code>AndroidManifest.xml</code>文件中，没有配置<code>MainActivity</code>和<code>SubActivity</code>的<code>taskAffinity</code>属性，<br>于是它们的<code>taskAffinity</code>属性值就默认为父标签<code>application</code>的<code>taskAffinity</code>属性值，这里，标签<code>application</code>的<code>taskAffinity</code>也没有配置，于是它们就默认为包名。<br>总的来说：<code>singleTask</code>的结论与<code>android:taskAffinity</code>相关：　　           <ul>
<li>设置了<code>singleTask</code>启动模式的<code>Activity</code>，它在启动的时候，会先在系统中查找属性值<code>affinity</code>等于它的属性值<code>taskAffinity</code>的任务栈的存在；如果存在这样的任务栈，它就会在这个任务栈中启动，否则就会在新任务栈中启动。<br>因此，如果我们想要设置了<code>singleTask</code>启动模式的<code>Activity</code>在新的任务栈中启动，就要为它设置一个独立的<code>taskAffinity</code>属性值。以<code>A</code>启动<code>B</code>来说当<code>A</code>和<code>B</code>的<code>taskAffinity</code>相同时：第一次创建<code>B</code>的实例时，并不会启动新的<code>task</code>，<br>而是直接将<code>B</code>添加到<code>A</code>所在的<code>task</code>；否则，将<code>B</code>所在<code>task</code>中位于<code>B</code>之上的全部<code>Activity</code>都删除，然后跳转到<code>B</code>中。</li>
<li>如果设置了<code>singleTask</code>启动模式的<code>Activity</code>不是在新的任务中启动时，它会在已有的任务中查看是否已经存在相应的<code>Activity</code>实例，如果存在，就会把位于这个<code>Activity</code>实例上面的<code>Activity</code>全部结束掉，<br>即最终这个Activity实例会位于任务的堆栈顶端中。以<code>A</code>启动<code>B</code>来说,当<code>A</code>和<code>B</code>的<code>taskAffinity</code>不同时：第一次创建<code>B</code>的实例时，会启动新的<code>task</code>，然后将<code>B</code>添加到新建的<code>task</code>中；否则，将<code>B</code>所在<code>task</code>中位于<code>B</code>之上的全部<code>Activity</code>都删除，然后跳转到<code>B</code>中。</li>
</ul>
</li>
<li>singleInstance<br>顾名思义，是单一实例的意思，即任意时刻只允许存在唯一的<code>Activity</code>实例，而且该<code>Activity</code>所在的<code>task</code>不能容纳除该<code>Activity</code>之外的其他<code>Activity</code>实例！<br>它与<code>singleTask</code>有相同之处，也有不同之处。<br>相同之处：任意时刻，最多只允许存在一个实例。<br>不同之处：<ul>
<li><code>singleTask</code>受<code>android:taskAffinity</code>属性的影响，而<code>singleInstance</code>不受<code>android:taskAffinity</code>的影响。 </li>
<li><code>singleTask</code>所在的<code>task</code>中能有其它的<code>Activity</code>，而<code>singleInstance</code>的<code>task</code>中不能有其他<code>Activity</code>。     </li>
<li>当跳转到<code>singleTask</code>类型的<code>Activity</code>，并且该<code>Activity</code>实例已经存在时，会删除该<code>Activity</code>所在<code>task</code>中位于该<code>Activity</code>之上的全部<code>Activity</code>实例；而跳转到<code>singleInstance</code>类型的<code>Activity</code>，并且该<code>Activity</code>已经存在时，<br>不需要删除其他<code>Activity</code>，因为它所在的<code>task</code>只有该<code>Activity</code>唯一一个<code>Activity</code>实例。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>邮箱 ：itgoyo@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/Android启动模式详解/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Android开发中的MVP模式详解" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/Android开发中的MVP模式详解/">Android开发中的MVP模式详解</a>
    </h1>
  

        
        <a href="/2015/01/01/Android开发中的MVP模式详解/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Android开发中的MVP模式详解"><a href="#Android开发中的MVP模式详解" class="headerlink" title="Android开发中的MVP模式详解"></a>Android开发中的MVP模式详解</h1><p><a href="https://github.com/CharonChui/AndroidNote/blob/master/JavaKnowledgePart/MVC%E4%B8%8EMVP%E5%8F%8AMVVM.md">MVC、MVP、MVVM介绍</a></p>
<p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/android_mvp.jpg?raw=true" alt="image"></p>
<p>在<code>Android</code>开发中，如果不注重架构的话，<code>Activity</code>类就会变得愈发庞大。这是因为在<code>Android</code>开发中<code>View</code>和其他的线程可以共存于<code>Activity</code>内。那最大的问题是什么呢？ 其实就是<code>Activity</code>中同时存在业务逻辑和<code>UI</code>逻辑。这导致增加了单元测试和维护的成本。</p>
<p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/activity_is_god.png?raw=true" alt="image"></p>
<p>这就是为什么要清晰架构的原因之一。不仅是因为<code>Activity</code>类变得臃肿，也是其他的一些问题，例如<code>Activity</code>和<code>Fragment</code>相结合时的生命周期、数据绑定等等。   </p>
<p>###MVP简介</p>
<p><code>MVP(Model,View,Presenter)</code>      </p>
<ul>
<li><code>View</code>：负责处理用户时间和视图展现。在<code>Android</code>中就可能是<code>Activity</code>或者<code>Fragment</code>。</li>
<li><code>Model</code>： 负责数据访问。数据可以是从接口或者本地数据库中获取。</li>
<li><code>Presenter</code>: 负责连接<code>View</code>和<code>Model</code>。</li>
</ul>
<p>用一句话来说:<code>MVP</code>其实就是面向接口编程，<code>V</code>实现接口，<code>P</code>使用接口。</p>
<p>清晰的架构:    </p>
<p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/mvp_a.png?raw=true" alt="image"></p>
<p>举个栗子:<br>在<code>Android Studio</code>中新建一个<code>Activity</code>，系统提供了<code>LoginActivity</code>，直接用它是极好的。    </p>
<p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/loginactivity.png?raw=true" width="50%" height="50%"></p>
<p>不得不说，<code>Material Design</code>的效果真是美美哒！</p>
<p>好，那我们就用用户登录页来按照<code>MVP</code>的模式实现一下:     </p>
<ul>
<li>M: 很显然Model应该是<code>User</code>类。</li>
<li>V: <code>View</code>就是<code>LoginActivity</code>。</li>
<li>P: P那我们一会就创建一个<code>LoginPresenter</code>类。</li>
</ul>
<p>齐了，那接下来就详细分析下他们这三部分:   </p>
<ul>
<li><code>User</code>: 应该有<code>email</code>, <code>password</code>, <code>boolean login(email, password)</code>。</li>
<li><code>LoginActivity</code>:点击登录应该要出<code>loading</code>页。登录成功后要进入下一个页面。如果登录失败应该弹<code>toast</code>提示。那就需要<code>void showLoading()</code>，<code>void hideLoading()</code>，<code>void showErrorTip()</code>,<code>void doLoginSuccess()</code>这四个方法。</li>
<li><code>LoginPresenter</code>:这是<code>Model</code>和<code>View</code>的桥梁。他需要做的处理业务逻辑，直接与<code>Model</code>打交道，然后将<code>UI</code>的逻辑交给<code>LoginActivity</code>处理。<br>那怎么做呢？ 按照我上面总结的那一句话，、<code>MVP</code>其实就是面向接口编程，<code>V</code>实现接口，<code>P</code>使用接口。很显然我们需要提供一个接口。那就新建一个<code>ILoginView</code>的接口。这里面有哪些方法呢？ 当然是上面我们在分析<code>LoginActiity</code>时提出的那四个方法。这样<code>LoginActivity</code>直接实现<code>ILoginView</code>接口就好。</li>
</ul>
<p>开始做:   </p>
<ul>
<li><p>先把<code>Model</code>做好吧，创建<code>User</code>类。  </p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String email;</div><div class="line">    <span class="keyword">private</span> String password;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String email, String password)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.email = email;</div><div class="line">        <span class="keyword">this</span>.password = password;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">login</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// do login request..</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>创建<code>ILoginView</code>接口，定义登录所需要的<code>ui</code>逻辑。    </p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ILoginView</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showLoading</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hideLoading</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showErrorTip</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doLoginSuccess</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>创建<code>LoginPresenter</code>类，使用<code>ILoginView</code>接口，那该类主要有什么功能呢？ 它主要是处理业务逻辑的，<br>  对于登录的话，当然是用户在<code>UI</code>页面输入邮箱和密码，然后<code>Presenter</code>去开线程、请求接口。然后得到登录结果再去让<code>UI</code>显示对应的视图。那自然就是有一个<code>void login(String email, String passowrd)</code>的方法了  </p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginPresenter</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ILoginView mLoginView;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginPresenter</span><span class="params">(ILoginView loginView)</span> </span>&#123;</div><div class="line">        mLoginView = loginView;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String email, String password)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(email) || TextUtils.isEmpty(password)) &#123;</div><div class="line">            <span class="comment">//</span></div><div class="line">            mLoginView.showErrorTip();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        mLoginView.showLoading();</div><div class="line">        User user = <span class="keyword">new</span> User(email, password);</div><div class="line"></div><div class="line">        <span class="comment">// do network request....</span></div><div class="line">        <span class="comment">// ....</span></div><div class="line">        onSuccess() &#123;</div><div class="line">            <span class="keyword">boolean</span> login = user.login();</div><div class="line">            <span class="keyword">if</span> (login) &#123;</div><div class="line">                mLoginView.doLoginSuccess();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                mLoginView.showErrorTip();</div><div class="line">            &#125;</div><div class="line">            mLoginView.hideLoading();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        onFailde() &#123;</div><div class="line">            mLoginView.showErrorTip();</div><div class="line">            mLoginView.hideLoading();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>创建<code>LoginActivity</code>，实现<code>ILoginView</code>的接口，然后内部调用<code>LoginPresenter</code>来处理业务逻辑。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">ILoginView</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> LoginPresenter mLoginPresenter;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> AutoCompleteTextView mEmailView;</div><div class="line">    <span class="keyword">private</span> EditText mPasswordView;</div><div class="line">    <span class="keyword">private</span> View mProgressView;</div><div class="line">    <span class="keyword">private</span> View mLoginButton;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_login);</div><div class="line">        mEmailView = (AutoCompleteTextView) findViewById(R.id.email);</div><div class="line">        mPasswordView = (EditText) findViewById(R.id.password);</div><div class="line">        mLoginButton = findViewById(R.id.email_sign_in_button);</div><div class="line">        mProgressView = findViewById(R.id.login_progress);</div><div class="line"></div><div class="line">        mLoginPresenter = <span class="keyword">new</span> LoginPresenter(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        mLoginButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                mLoginPresenter.login(mEmailView.getText().toString().trim(), mPasswordView.getText().toString().trim());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showLoading</span><span class="params">()</span> </span>&#123;</div><div class="line">        mProgressView.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hideLoading</span><span class="params">()</span> </span>&#123;</div><div class="line">        mProgressView.setVisibility(View.GONE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showErrorTip</span><span class="params">()</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"login faled"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doLoginSuccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"login success"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<p>上面只是抛砖引玉。<code>MVP</code>的有点十分明显，就是代码解耦、可以让逻辑清晰，但是同样它也会有缺点，它的缺点就是项目的复杂程度会增加，项目中会多出很多类。<br>之前很多人都在讨论该如何去正确的设计使用<code>MVP</code>来避免它的缺点，众说纷纭，很多人讨论的你死我活。直到<code>Google</code>发布了<code>MVP架构蓝图</code>，大家才意识到这才是规范。     </p>
<p>项目地址:<a href="https://github.com/googlesamples/android-architecture">android-architecture</a><br><code>Google</code>将该项目命名为<code>Android</code>的架构蓝图，我想从名字上已可以看穿一切。</p>
<p>在它的官方介绍中是这样说的:   </p>
<blockquote>
<p>The Android framework offers a lot of flexibility when it comes to defining how to organize and architect an Android app. This freedom, whilst very valuable, can also result in apps with large classes, inconsistent naming and architectures (or lack of) that can make testing, maintaining and extending difficult.</p>
<p>Android Architecture Blueprints is meant to demonstrate possible ways to help with these common problems. In this project we offer the same application implemented using different architectural concepts and tools.</p>
<p>You can use these samples as a reference or as a starting point for creating your own apps. The focus here is on code structure, architecture, testing and maintainability. However, bear in mind that there are many ways to build apps with these architectures and tools, depending on your priorities, so these shouldn’t be considered canonical examples. The UI is deliberately kept simple.</p>
</blockquote>
<p>已完成的示例:  </p>
<ul>
<li>todo-mvp/ - Basic Model-View-Presenter architecture.</li>
<li>todo-mvp-loaders/ - Based on todo-mvp, fetches data using Loaders.</li>
<li>todo-mvp-databinding/ - Based on todo-mvp, uses the Data Binding Library.</li>
<li>todo-mvp-clean/ - Based on todo-mvp, uses concepts from Clean Architecture.</li>
<li>todo-mvp-dagger/ - Based on todo-mvp, uses Dagger2 for Dependency Injection</li>
<li>todo-mvp-contentproviders/ - Based on todo-mvp-loaders, fetches data using Loaders and uses Content Providers</li>
<li>todo-mvp-rxjava/ - Based on todo-mvp, uses RxJava for concurrency and data layer abstraction.</li>
</ul>
<p>我们接下来就用<code>todo-mvp</code>来进行分析，这个应用非常简单，主要有以下几个功能:     </p>
<ul>
<li>列表页:展示所有的<code>todo</code>项   </li>
<li>添加页:添加<code>todo</code>项</li>
<li>详情页:查看<code>todo</code>项的详情</li>
<li>统计页:查看当前所有已完成<code>todo</code>及未完成项的统计数据     </li>
</ul>
<p>代码并不多:   </p>
<p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/google_mvp.png?raw=true" width="50%" height="50%"></p>
<p>功能也比较简单:    </p>
<p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/google_todo_main.png?raw=true" width="40%" height="40%">    <img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/google_todp_add.png?raw=true" width="40%" height="40%"><br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/google_todo_list.png?raw=true" width="40%" height="40%">          <img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/google_todo_delete.png?raw=true" width="40%" height="40%"></p>
<p>我们先从两个<code>Base</code>类开始看，分别是<code>BaseView</code>以及<code>BasePresenter</code>类。 </p>
<p><code>BaseView</code>类:   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseView</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setPresenter</span><span class="params">(T presenter)</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>BaseView</code>中的<code>setPresenter()</code>是将<code>Presenter</code>的实例传入到<code>View</code>中。<br><code>BasePresenter</code>类:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BasePresenter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>BasePresenter</code>中只有一个<code>start()</code>方法，从名字上我们就能看出他的作用。 </p>
<p>接下来继续看一下项目的入口<code>Activity</code>，<code>TaskDetailActivity</code>的实现:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskDetailActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXTRA_TASK_ID = <span class="string">"TASK_ID"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">        setContentView(R.layout.taskdetail_act);</div><div class="line"></div><div class="line">        <span class="comment">// Set up the toolbar.</span></div><div class="line">        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);</div><div class="line">        setSupportActionBar(toolbar);</div><div class="line">        ActionBar ab = getSupportActionBar();</div><div class="line">        ab.setDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</div><div class="line">        ab.setDisplayShowHomeEnabled(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Get the requested task id</span></div><div class="line">        String taskId = getIntent().getStringExtra(EXTRA_TASK_ID);</div><div class="line">        </div><div class="line">        TaskDetailFragment taskDetailFragment = (TaskDetailFragment) getSupportFragmentManager()</div><div class="line">                .findFragmentById(R.id.contentFrame);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (taskDetailFragment == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// 创建对应的Fragment</span></div><div class="line">            taskDetailFragment = TaskDetailFragment.newInstance(taskId);</div><div class="line"></div><div class="line">            ActivityUtils.addFragmentToActivity(getSupportFragmentManager(),</div><div class="line">                    taskDetailFragment, R.id.contentFrame);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Create the presenter，因为Presenter是M和V的连接桥，所以在第二个参数中会传入TasksRepository</span></div><div class="line">        <span class="keyword">new</span> TaskDetailPresenter(</div><div class="line">                taskId,</div><div class="line">                Injection.provideTasksRepository(getApplicationContext()),</div><div class="line">                taskDetailFragment);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onSupportNavigateUp</span><span class="params">()</span> </span>&#123;</div><div class="line">        onBackPressed();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到这里<code>Activity</code>相当于一个管理类，里面控制着<code>MVP</code>中的<code>V</code>和<code>P</code>,上面的代码主要做了两部分:  </p>
<ul>
<li>创建对应的<code>Fragment</code></li>
<li>创建对应的<code>Presenter</code></li>
</ul>
<p>这里分别看一下<code>TaskDetailFragment</code>和<code>TaskDetailPresenter</code>的源码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskDetailFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> <span class="keyword">implements</span> <span class="title">TaskDetailContract</span>.<span class="title">View</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> TaskDetailContract.Presenter mPresenter;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TaskDetailFragment <span class="title">newInstance</span><span class="params">(@Nullable String taskId)</span> </span>&#123;</div><div class="line">        Bundle arguments = <span class="keyword">new</span> Bundle();</div><div class="line">        arguments.putString(ARGUMENT_TASK_ID, taskId);</div><div class="line">        TaskDetailFragment fragment = <span class="keyword">new</span> TaskDetailFragment();</div><div class="line">        fragment.setArguments(arguments);</div><div class="line">        <span class="keyword">return</span> fragment;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onResume();</div><div class="line">        <span class="comment">// 调用Presenter.start()方法</span></div><div class="line">        mPresenter.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></div><div class="line">                             Bundle savedInstanceState) &#123;</div><div class="line">        ....</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPresenter</span><span class="params">(@NonNull TaskDetailContract.Presenter presenter)</span> </span>&#123;</div><div class="line">        <span class="comment">// 将Prsenter传递给V中 </span></div><div class="line">        mPresenter = checkNotNull(presenter);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ....</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>及<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskDetailPresenter</span> <span class="keyword">implements</span> <span class="title">TaskDetailContract</span>.<span class="title">Presenter</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TasksRepository mTasksRepository;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TaskDetailContract.View mTaskDetailView;</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="keyword">private</span> String mTaskId;</div><div class="line"></div><div class="line">    <span class="comment">// 把M和V传递进来</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskDetailPresenter</span><span class="params">(@Nullable String taskId,</span></span></div><div class="line">                               @NonNull TasksRepository tasksRepository,</div><div class="line">                               @NonNull TaskDetailContract.View taskDetailView) &#123;</div><div class="line">        mTaskId = taskId;</div><div class="line">        mTasksRepository = checkNotNull(tasksRepository, <span class="string">"tasksRepository cannot be null!"</span>);</div><div class="line">        mTaskDetailView = checkNotNull(taskDetailView, <span class="string">"taskDetailView cannot be null!"</span>);</div><div class="line">        <span class="comment">// 将该Presenter设置给V</span></div><div class="line">        mTaskDetailView.setPresenter(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 调用获取数据的方法</span></div><div class="line">        openTask();</div><div class="line">    &#125;</div><div class="line">    ....</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到上面分别实现了<code>TaskDetailContract</code>类中的<code>Presenter</code>和<code>View</code>接口，而不是<code>BasePresenter</code>和<code>BaseView</code>中的接口，那这个<code>TaskDetailContract</code>类是什么呢？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * This specifies the contract between the view and the presenter.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TaskDetailContract</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">View</span> <span class="keyword">extends</span> <span class="title">BaseView</span>&lt;<span class="title">Presenter</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">setLoadingIndicator</span><span class="params">(<span class="keyword">boolean</span> active)</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">showMissingTask</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">hideTitle</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">showTitle</span><span class="params">(String title)</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">hideDescription</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">showDescription</span><span class="params">(String description)</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">showCompletionStatus</span><span class="params">(<span class="keyword">boolean</span> complete)</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">showEditTask</span><span class="params">(String taskId)</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">showTaskDeleted</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">showTaskMarkedComplete</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">showTaskMarkedActive</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">isActive</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Presenter</span> <span class="keyword">extends</span> <span class="title">BasePresenter</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">editTask</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">deleteTask</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">completeTask</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">activateTask</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>按照上面描述的介绍可以看出通过这个连接类将<code>VP</code>联系到了一起，它统一管理<code>view</code>和<code>presenter</code>中的所有接口，这样比起分开写会更加清晰。</p>
<p>分析完<code>VP</code>之后我们继续看一下<code>TaskDetailPresenter</code>类，因为<code>Presenter</code>是<code>MV</code>的桥梁。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">TaskDetailPresenter</span><span class="params">(@Nullable String taskId,</span></span></div><div class="line">                               @NonNull TasksRepository tasksRepository,</div><div class="line">                               @NonNull TaskDetailContract.View taskDetailView) &#123;</div><div class="line">        mTaskId = taskId;</div><div class="line">        mTasksRepository = checkNotNull(tasksRepository, <span class="string">"tasksRepository cannot be null!"</span>);</div><div class="line">        mTaskDetailView = checkNotNull(taskDetailView, <span class="string">"taskDetailView cannot be null!"</span>);</div><div class="line"></div><div class="line">        mTaskDetailView.setPresenter(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</div><div class="line">        openTask();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openTask</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (Strings.isNullOrEmpty(mTaskId)) &#123;</div><div class="line">            mTaskDetailView.showMissingTask();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 控制V显示UI</span></div><div class="line">        mTaskDetailView.setLoadingIndicator(<span class="keyword">true</span>);</div><div class="line">    <span class="comment">// 通过M去获取数据</span></div><div class="line">        mTasksRepository.getTask(mTaskId, <span class="keyword">new</span> TasksDataSource.GetTaskCallback() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTaskLoaded</span><span class="params">(Task task)</span> </span>&#123;</div><div class="line">                <span class="comment">// The view may not be able to handle UI updates anymore</span></div><div class="line">                <span class="keyword">if</span> (!mTaskDetailView.isActive()) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                mTaskDetailView.setLoadingIndicator(<span class="keyword">false</span>);</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> == task) &#123;</div><div class="line">                    mTaskDetailView.showMissingTask();</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    showTask(task);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDataNotAvailable</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="comment">// The view may not be able to handle UI updates anymore</span></div><div class="line">                <span class="keyword">if</span> (!mTaskDetailView.isActive()) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                mTaskDetailView.showMissingTask();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>在它的构造函数中传入了一个<code>TasksRepository</code>，这个就是<code>Model</code>层。而在该<code>Presenter</code>中的<code>start()</code>方法回去调用获取数据的方法。   </p>
<p>我们继续看一下<code>M</code>层<code>TasksRepository</code>的实现:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Concrete implementation to load tasks from the data sources into a cache.</div><div class="line"> * &lt;p&gt;</div><div class="line"> * For simplicity, this implements a dumb synchronisation between locally persisted data and data</div><div class="line"> * obtained from the server, by using the remote data source only if the local database doesn't</div><div class="line"> * exist or is empty.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TasksRepository</span> <span class="keyword">implements</span> <span class="title">TasksDataSource</span> </span>&#123;</div><div class="line">    ....</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>先看一下<code>TasksDataSource</code>接口:   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Main entry point for accessing tasks data.</div><div class="line"> * &lt;p&gt;</div><div class="line"> * For simplicity, only getTasks() and getTask() have callbacks. Consider adding callbacks to other</div><div class="line"> * methods to inform the user of network/database errors or successful operations.</div><div class="line"> * For example, when a new task is created, it's synchronously stored in cache but usually every</div><div class="line"> * operation on database or network should be executed in a different thread.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TasksDataSource</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">LoadTasksCallback</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onTasksLoaded</span><span class="params">(List&lt;Task&gt; tasks)</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onDataNotAvailable</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">GetTaskCallback</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onTaskLoaded</span><span class="params">(Task task)</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onDataNotAvailable</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getTasks</span><span class="params">(@NonNull LoadTasksCallback callback)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getTask</span><span class="params">(@NonNull String taskId, @NonNull GetTaskCallback callback)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveTask</span><span class="params">(@NonNull Task task)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">completeTask</span><span class="params">(@NonNull Task task)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">completeTask</span><span class="params">(@NonNull String taskId)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">activateTask</span><span class="params">(@NonNull Task task)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">activateTask</span><span class="params">(@NonNull String taskId)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clearCompletedTasks</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refreshTasks</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteAllTasks</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteTask</span><span class="params">(@NonNull String taskId)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看出<code>M</code>层被赋予了数据获取的功能，与之前我们写的<code>M</code>层只定义实体对象截然不同，数据的增删改查都是<code>M</code>层实现的。<code>Presenter</code>只需要调用<code>M</code>层的方法即可。这样<code>model、presenter、view</code>都只处理各自的任务，此种实现确实是单一职责最好的诠释。</p>
<p>这里我们就以上面用到的<code>getTasks()</code>方法为例来介绍一下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getTask</span><span class="params">(@NonNull <span class="keyword">final</span> String taskId, @NonNull <span class="keyword">final</span> GetTaskCallback callback)</span> </span>&#123;</div><div class="line">        checkNotNull(taskId);</div><div class="line">        checkNotNull(callback);</div><div class="line">        <span class="comment">// 从缓存中获取数据</span></div><div class="line">        Task cachedTask = getTaskWithId(taskId);</div><div class="line"></div><div class="line">        <span class="comment">// Respond immediately with cache if available</span></div><div class="line">        <span class="keyword">if</span> (cachedTask != <span class="keyword">null</span>) &#123;</div><div class="line">            callback.onTaskLoaded(cachedTask);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Load from server/persisted if needed.</span></div><div class="line"></div><div class="line">        <span class="comment">// Is the task in the local data source? If not, query the network.</span></div><div class="line">        mTasksLocalDataSource.getTask(taskId, <span class="keyword">new</span> GetTaskCallback() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTaskLoaded</span><span class="params">(Task task)</span> </span>&#123;</div><div class="line">                <span class="comment">// Do in memory cache update to keep the app UI up to date</span></div><div class="line">                <span class="keyword">if</span> (mCachedTasks == <span class="keyword">null</span>) &#123;</div><div class="line">                    mCachedTasks = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</div><div class="line">                &#125;</div><div class="line">                mCachedTasks.put(task.getId(), task);</div><div class="line">                callback.onTaskLoaded(task);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDataNotAvailable</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="comment">// 服务器的数据源</span></div><div class="line">                mTasksRemoteDataSource.getTask(taskId, <span class="keyword">new</span> GetTaskCallback() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTaskLoaded</span><span class="params">(Task task)</span> </span>&#123;</div><div class="line">                        <span class="comment">// Do in memory cache update to keep the app UI up to date</span></div><div class="line">                        <span class="keyword">if</span> (mCachedTasks == <span class="keyword">null</span>) &#123;</div><div class="line">                            mCachedTasks = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</div><div class="line">                        &#125;</div><div class="line">                        mCachedTasks.put(task.getId(), task);</div><div class="line">                        callback.onTaskLoaded(task);</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDataNotAvailable</span><span class="params">()</span> </span>&#123;</div><div class="line">                        callback.onDataNotAvailable();</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>上面的注释说的非常明白了，这里就不去仔细看了。</p>
<p>下面用一张图来总结一下:   </p>
<p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/google_todo_mvp.png?raw=true" alt="image"></p>
<p>由于架构的引入，虽然代码量有了一定的上升，但是功能分离的非常清晰明确，而且每个部分都可以进行单独的测试，对于后期的扩展维护会更加简单容易。</p>
<hr>
<ul>
<li>邮箱 ：itgoyo@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/Android开发中的MVP模式详解/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-BroadcastReceiver安全问题" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/BroadcastReceiver安全问题/">BroadcastReceiver安全问题</a>
    </h1>
  

        
        <a href="/2015/01/01/BroadcastReceiver安全问题/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="BroadcastReceiver安全问题"><a href="#BroadcastReceiver安全问题" class="headerlink" title="BroadcastReceiver安全问题"></a>BroadcastReceiver安全问题</h1><p><code>BroadcastReceiver</code>设计的初衷是从全局考虑可以方便应用程序和系统、应用程序之间、应用程序内的通信，所以对单个应用程序而言<code>BroadcastReceiver</code>是存在安全性问题的(恶意程序脚本不断的去发送你所接收的广播)</p>
<ul>
<li><p>保证发送的广播要发送给指定的对象<br>  当应用程序发送某个广播时系统会将发送的<code>Intent</code>与系统中所有注册的<code>BroadcastReceiver</code>的<code>IntentFilter</code>进行匹配，若匹配成功则执行相应的<code>onReceive</code>函数。可以通过类似<code>sendBroadcast(Intent, String)</code>的接口在发送广播时指定接收者必须具备的<code>permission</code>或通过<code>Intent.setPackage</code>设置广播仅对某个程序有效。</p>
</li>
<li><p>保证我接收到的广播室指定对象发送过来的<br>  当应用程序注册了某个广播时，即便设置了<code>IntentFilter</code>还是会接收到来自其他应用程序的广播进行匹配判断。对于动态注册的广播可以通过类似<code>registerReceiver(BroadcastReceiver, IntentFilter, String, android.os.Handler)</code>的接口指定发送者必须具备的<code>permission</code>，对于静态注册的广播可以通过<code>android:exported=&quot;false&quot;</code>属性表示接收者对外部应用程序不可用，即不接受来自外部的广播。</p>
</li>
</ul>
<p><code>android.support.v4.content.LocalBroadcastManager</code>工具类，可以实现在自己的进程内进行局部广播发送与注册，使用它比直接通过sendBroadcast(Intent)发送系统全局广播有以下几个好处：</p>
<ul>
<li>因广播数据在本应用范围内传播，你不用担心隐私数据泄露的问题。</li>
<li>不用担心别的应用伪造广播，造成安全隐患。</li>
<li>相比在系统内发送全局广播，它更高效。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"> LocalBroadcastManager mLocalBroadcastManager;  </div><div class="line"> BroadcastReceiver mReceiver;  </div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">	 IntentFilter filter = <span class="keyword">new</span> IntentFilter();  </div><div class="line">	 filter.addAction(<span class="string">"test"</span>);  </div><div class="line"></div><div class="line">	 mReceiver = <span class="keyword">new</span> BroadcastReceiver() &#123;  </div><div class="line">		<span class="meta">@Override</span>  </div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;  </div><div class="line">			<span class="keyword">if</span> (intent.getAction().equals(<span class="string">"test"</span>)) &#123;  </div><div class="line">				<span class="comment">//Do Something</span></div><div class="line">			&#125; </div><div class="line">		&#125;  </div><div class="line">	&#125;;  </div><div class="line">	mLocalBroadcastManager = LocalBroadcastManager.getInstance(<span class="keyword">this</span>);</div><div class="line">	mLocalBroadcastManager.registerReceiver(mReceiver, filter);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">   mLocalBroadcastManager.unregisterReceiver(mReceiver);</div><div class="line">   <span class="keyword">super</span>.onDestroy();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<ul>
<li>邮箱 ：itgoyo@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/BroadcastReceiver安全问题/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Handler导致内存泄露分析" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/Handler导致内存泄露分析/">Handler导致内存泄露分析</a>
    </h1>
  

        
        <a href="/2015/01/01/Handler导致内存泄露分析/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Handler导致内存泄露分析"><a href="#Handler导致内存泄露分析" class="headerlink" title="Handler导致内存泄露分析"></a>Handler导致内存泄露分析</h1><p>有关内存泄露请猛戳<a href="https://github.com/CharonChui/AndroidNote/blob/master/Android%E5%9F%BA%E7%A1%80/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F.md">内存泄露</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Handler mHandler = <span class="keyword">new</span> Handler() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">	    <span class="comment">// do something.</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当我们这样创建<code>Handler</code>的时候<code>Android Lint</code>会提示我们这样一个<code>warning： In Android, Handler classes should be static or leaks might occur.</code>。       </p>
<p>一直以来没有仔细的去分析泄露的原因，先把主要原因列一下：    </p>
<ul>
<li><code>Android</code>程序第一次创建的时候，默认会创建一个<code>Looper</code>对象，<code>Looper</code>去处理<code>Message Queue</code>中的每个<code>Message</code>,主线程的<code>Looper</code>存在整个应用程序的生命周期.</li>
<li><code>Hanlder</code>在主线程创建时会关联到<code>Looper</code>的<code>Message Queue</code>,<code>Message</code>添加到消息队列中的时候<code>Message(排队的Message)</code>会持有当前<code>Handler</code>引用，<br>当<code>Looper</code>处理到当前消息的时候，会调用<code>Handler#handleMessage(Message)</code>.就是说在<code>Looper</code>处理这个<code>Message</code>之前，<br>会有一条链<code>MessageQueue -&gt; Message -&gt; Handler -&gt; Activity</code>，由于它的引用导致你的<code>Activity</code>被持有引用而无法被回收`</li>
<li><strong>在java中，no-static的内部类会隐式的持有当前类的一个引用。static的内部类则没有。</strong></li>
</ul>
<p>##具体分析<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Handler mHandler = <span class="keyword">new</span> Handler() &#123;</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">		  <span class="comment">// do something</span></div><div class="line">		&#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">	<span class="comment">// 发送一个10分钟后执行的一个消息</span></div><div class="line">	mHandler.postDelayed(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">	  <span class="meta">@Override</span></div><div class="line">	  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; &#125;</div><div class="line">	&#125;, <span class="number">600000</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 结束当前的Activity</span></div><div class="line">	finish();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在<code>finish()</code>的时候，该<code>Message</code>还没有被处理，<code>Message</code>持有<code>Handler</code>,<code>Handler</code>持有<code>Activity</code>,这样会导致该<code>Activity</code>不会被回收，就发生了内存泄露.</p>
<p>##解决方法 </p>
<ul>
<li>通过程序逻辑来进行保护。<ul>
<li>如果<code>Handler</code>中执行的是耗时的操作，在关闭<code>Activity</code>的时候停掉你的后台线程。线程停掉了，就相当于切断了<code>Handler</code>和外部连接的线，<br><code>Activity</code>自然会在合适的时候被回收。 </li>
<li>如果<code>Handler</code>是被<code>delay</code>的<code>Message</code>持有了引用，那么在<code>Activity</code>的<code>onDestroy()</code>方法要调用<code>Handler</code>的<code>remove*</code>方法，把消息对象从消息队列移除就行了。 <ul>
<li>关于<code>Handler.remove*</code>方法<ul>
<li><code>removeCallbacks(Runnable r)</code> ——清除r匹配上的Message。    </li>
<li><code>removeC4allbacks(Runnable r, Object token)</code> ——清除r匹配且匹配token（Message.obj）的Message，token为空时，只匹配r。</li>
<li><code>removeCallbacksAndMessages(Object token)</code> ——清除token匹配上的Message。</li>
<li><code>removeMessages(int what)</code> ——按what来匹配     </li>
<li><code>removeMessages(int what, Object object)</code> ——按what来匹配<br>我们更多需要的是清除以该<code>Handler</code>为<code>target</code>的所有<code>Message(Callback)</code>就调用如下方法即可<code>handler.removeCallbacksAndMessages(null)</code>;</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>将<code>Handler</code>声明为静态类。<br>  静态类不持有外部类的对象，所以你的<code>Activity</code>可以随意被回收。但是不持有<code>Activity</code>的引用，如何去操作<code>Activity</code>中的一些对象？ 这里要用到弱引用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> MyHandler mHandler;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		mHandler = <span class="keyword">new</span> MyHandler(<span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// Remove all Runnable and Message.</span></div><div class="line">		mHandler.removeCallbacksAndMessages(<span class="keyword">null</span>);</div><div class="line">		<span class="keyword">super</span>.onDestroy();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">		<span class="comment">// WeakReference to the outer class's instance.</span></div><div class="line">		<span class="keyword">private</span> WeakReference&lt;MyActivity&gt; mOuter;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MyHandler</span><span class="params">(MyActivity activity)</span> </span>&#123;</div><div class="line">			mOuter = <span class="keyword">new</span> WeakReference&lt;MyActivity&gt;(activity);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">			MyActivity outer = mOuter.get();</div><div class="line">			<span class="keyword">if</span> (outer != <span class="keyword">null</span>) &#123;</div><div class="line">				<span class="comment">// Do something with outer as your wish.</span></div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<ul>
<li>邮箱 ：itgoyo@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/Handler导致内存泄露分析/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-HttpURLConnection与HttpClient" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/HttpURLConnection与HttpClient/">HttpURLConnection与HttpClient</a>
    </h1>
  

        
        <a href="/2015/01/01/HttpURLConnection与HttpClient/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="HttpURLConnection与HttpClient"><a href="#HttpURLConnection与HttpClient" class="headerlink" title="HttpURLConnection与HttpClient"></a>HttpURLConnection与HttpClient</h1><ul>
<li><code>Java</code>的<code>HttpURLConnection</code><br>  请求默认带<code>Gzip</code>压缩。</li>
<li><code>Apache</code>的<code>HttpClient</code><br>  请求默认不带<code>Gzip</code>压缩。</li>
</ul>
<p>一般对于<code>API</code>请求返回的数据大多是<code>Json</code>类的字符串，<code>Gzip</code>压缩可以使数据大小大幅降低。<br><code>Retrofit</code>及<code>Volley</code>框架默认在<code>Android Gingerbread(API 9)</code>及以上都是用<code>HttpURLConnection</code>，9以下用<code>HttpClient</code>。       </p>
<hr>
<ul>
<li>邮箱 ：itgoyo@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/HttpURLConnection与HttpClient/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Gradle专题" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/01/Gradle专题/">Gradle专题</a>
    </h1>
  

        
        <a href="/2015/01/01/Gradle专题/" class="archive-article-date">
  	<time datetime="2014-12-31T17:11:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-01-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Gradle专题"><a href="#Gradle专题" class="headerlink" title="Gradle专题"></a>Gradle专题</h1><p>随着<code>Google</code>对<code>Eclipse</code>的无情抛弃以及<code>Studio</code>的不断壮大，<code>Android</code>开发者逐渐拜倒在<code>Studio</code>的石榴裙下。<br>而作为<code>Studio</code>的默认编译方式，<code>Gradle</code>已逐渐普及。我最开始是被它的多渠道打包所吸引。关于多渠道打包，请看之前我写的文章<a href="https://github.com/CharonChui/AndroidNote/blob/master/Android%E5%9F%BA%E7%A1%80/AndroidStudio%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B(%E7%AC%AC%E4%B8%83%E5%BC%B9">AndroidStudio使用教程(第七弹)</a>.md)</p>
<p>接下来我们就系统的学习一下<code>Gradle</code>。    </p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>Gradle</code>是以<code>Groovy</code>语言为基础，面向<code>Java</code>应用为主。基于<code>DSL(Domain Specific Language)</code>语法的自动化构建工具。</p>
<p><code>Gradle</code>集合了<code>Ant</code>的灵活性和强大功能，同时也集合了<code>Maven</code>的依赖管理和约定，从而创造了一个更有效的构建方式。凭借<code>Groovy</code>的<code>DSL</code>和创新打包方式，<code>Gradle</code>提供了一个可声明的方式，并在合理默认值的基础上描述所有类型的构建。 <code>Gradle</code>目前已被选作许多开源项目的构建系统。</p>
<p>因为<code>Gradle</code>是基于<code>DSL</code>语法的，如果想看到<code>build.gradle</code>文件中全部可以选项的配置，可以看这里<br><a href="http://google.github.io/android-gradle-dsl/current/" target="_blank" rel="external">DSL Reference</a></p>
<h2 id="基本的项目设置"><a href="#基本的项目设置" class="headerlink" title="基本的项目设置"></a>基本的项目设置</h2><p>一个<code>Gradle</code>项目通过一个在项目根目录中的<code>build.gradle</code>文件来描述它的构建。</p>
<p>###简单的<code>Build</code>文件</p>
<p>最简单的<code>Android</code>应用中的<code>build.gradle</code>都会包含以下几个配置：<br><code>Project</code>根目录的<code>build.gradle</code>:       </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath &apos;com.android.tools.build:gradle:1.5.0&apos;</div><div class="line"></div><div class="line">        // NOTE: Do not place your application dependencies here; they belong</div><div class="line">        // in the individual module build.gradle files</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Module</code>中的<code>build.gradle</code>:    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">apply plugin: &apos;com.android.application&apos;</div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion 23</div><div class="line">    buildToolsVersion &quot;23.0.3&quot;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>buildscript { ... }</code>配置了编译时的代码驱动. 这种情况下，它声明所使用的是<code>jCenter</code>仓库。还有一个声明所依赖的在<code>Maven</code>文件的路径。这里声明的包含了<code>Android</code>插件所使用的1.5.0版本的<code>Gradle</code>. <strong><em>注意:</em></strong>这只会影响<code>build</code>中运行的代码，不是项目中。项目中需要声明它自己所需要仓库和依赖关系。</li>
<li><code>apply plugin : com.android.application</code>，声明使用<code>com.androdi.application</code>插件。这是构建<code>Android</code>应用所需要的插件。</li>
<li><code>android{...}</code>配置了所有<code>Android</code>构建时的参数。默认情况下，只有编译的目标版本以及编译工具的版本是需要的。</li>
</ul>
<p>重要: 这里只能使用<code>com.android.application</code>插件。如果使用<code>java</code>插件将会报错。</p>
<p>###目录结构<br><code>module/src/main</code>下的目录结构，因为有时候很多人把<code>so</code>放到<code>libs</code>目录就会报错:    </p>
<ul>
<li>java/</li>
<li>res/</li>
<li>AndroidManifest.xml</li>
<li>assets/</li>
<li>aidl/  </li>
<li>jniLibs/</li>
<li>jni/  </li>
<li>rs/</li>
</ul>
<p>###配置目录结构<br>如果项目的结构不标准的时候，可能就需要去配置它。<code>Android</code>插件使用了相似的语法，但是因为它有自己的<code>sourceSets</code>，所以要在<code>android</code>代码块中进行配置。下面就是一个从<code>Eclipse</code>的老项目结构中配置主要代码并且将<code>androidTest</code>的<code>sourceSet</code>设置给<code>tests</code>目录的例子:     </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    sourceSets &#123;</div><div class="line">        main &#123;</div><div class="line">            manifest.srcFile &apos;AndroidManifest.xml&apos;</div><div class="line">            java.srcDirs = [&apos;src&apos;]</div><div class="line">            resources.srcDirs = [&apos;src&apos;]</div><div class="line">            aidl.srcDirs = [&apos;src&apos;]</div><div class="line">            renderscript.srcDirs = [&apos;src&apos;]</div><div class="line">            res.srcDirs = [&apos;res&apos;]</div><div class="line">            assets.srcDirs = [&apos;assets&apos;]</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        androidTest.setRoot(&apos;tests&apos;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>就像有些人就是要把<code>so</code>放到<code>libs</code>目录中(这类人有点犟)，那就需要这样进行修改。<br><strong><em>注意:</em></strong>因为在旧的项目结构中所有的源文件(<code>Java</code>,<code>AIDL</code>和<code>RenderScript</code>)都放到同一个目录中，我们需要将<code>sourceSet</code>中的这些新部件都设置给<code>src</code>目录。</p>
<h2 id="Build-Tasks"><a href="#Build-Tasks" class="headerlink" title="Build Tasks"></a>Build Tasks</h2><p>对构建文件声明插件时通常或自动创建一些列的构建任务去执行。不管<code>Java</code>插件还是<code>Android</code>插件都是这样。<code>Android</code>常规的任务如下：    </p>
<ul>
<li><code>assemble</code>生成项目<code>output</code>目录中的内容的任务。</li>
<li><code>check</code>执行所有的检查的任务。</li>
<li><code>build</code>执行<code>assemble</code>和<code>check</code>的任务。</li>
<li><code>clean</code>清理项目<code>output</code>目录的任务。</li>
</ul>
<p>在<code>Android</code>项目中至少会有两种<code>output</code>输出:一个<code>debug apk</code>和一个<code>release apk</code>。他们都有自己的主任务来分别执行构建:    </p>
<ul>
<li><code>assemble</code><ul>
<li><code>assembleDebug</code></li>
<li><code>assembleRelease</code>  </li>
</ul>
</li>
</ul>
<p><strong><em>提示:</em></strong><code>Gradle</code>支持通过命令行执行任务首字母缩写的方式。例如:<br>在没有其他任务符合<code>aR</code>的前提下，<code>gradle aR</code>与<code>gradle assembleRelease</code>是相同的。</p>
<p>最后，构建插件创建了为所有<code>build type(debug, release, test)</code>类型安装和卸载的任务，只要他们能被安装(需要签名)。</p>
<ul>
<li><code>installDebug</code></li>
<li><code>installRelease</code></li>
<li><code>uninstallAll</code><ul>
<li><code>uninstallDebug</code></li>
<li><code>uninstallRelease</code></li>
<li><code>uninstallDebugAndroidTest</code></li>
</ul>
</li>
</ul>
<p>###基本的<code>Build</code>定制</p>
<p><code>Android</code>插件提供了一些列的<code>DSL</code>来让直接从构建系统中做大部分的定制。</p>
<p>#####<code>Manifest</code>整体部分<br><code>DSL</code>提供了很多重要的配置<code>manifest</code>文件的参数，例如:     </p>
<ul>
<li><code>minSdkVersion</code></li>
<li><code>targetSdkVersion</code></li>
<li><code>versionCode</code></li>
<li><code>versionName</code></li>
<li><code>applicationId</code></li>
<li><code>testApplicationId</code></li>
<li><code>testInstrumentationRunnder</code></li>
</ul>
<p><a href="http://google.github.io/android-gradle-dsl/current/" target="_blank" rel="external">Android Plugin DSL Reference</a>提供了一个完整的构建参数列表。</p>
<p>把这些<code>manifest</code>属性放到<code>build</code>文件中的一个重要功能就是它可以被动态的设置。例如，可以通过读取一个文件或者其他逻辑来获取版本名称。     </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">def computeVersionName() &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion 23</div><div class="line">    buildToolsVersion &quot;23.0.1&quot;</div><div class="line"></div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        versionCode 12 </div><div class="line">        versionName computeVersionName()</div><div class="line">        minSdkVersion 16</div><div class="line">        targetSdkVersion 23</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong><em>注意:</em></strong>不要使用可能与现有给定冲突的方法名。例如<code>defaultConfig{...}</code>中使用<code>getVersionName()</code>方法将会自动使用<code>defaultConfig.getVersionName()</code>来带起自定义的方法。</p>
<p>#####<code>Build Types</code></p>
<p>默认情况下<code>Android</code>插件会自动将应用程序设置成有一个<code>debug</code>版本和一个<code>release</code>版本。<br>这就是通过调用<code>BuildType</code>对象完成。默认情况下会创建两个实例，一个<code>debug</code>实例和一个<code>release</code>实例。<code>Android</code>插件同样允许通过其他的<code>Build Types</code>来定制其他的实例。这就是通过<code>buildTypes</code>来设置的:     </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    buildTypes &#123;</div><div class="line">        debug &#123;</div><div class="line">            applicationIdSuffix &quot;.debug&quot;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        jnidebug &#123;</div><div class="line">            initWith(buildTypes.debug)</div><div class="line">            applicationIdSuffix &quot;.jnidebug&quot;</div><div class="line">            jniDebuggable true</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的代码执行了以下操作:     </p>
<ul>
<li>配置了默认<code>debug</code>的<code>Build Type</code>:     <ul>
<li>设置了它的<code>applicationId</code>。这样<code>debug</code>模式就能与<code>release</code>模式的<code>apk</code>同时安装在同一手机上。</li>
</ul>
</li>
<li>创建了一个新的<code>jnidebug</code>的<code>Build Type</code>，并且把它设置为<code>debug</code>的拷贝。</li>
<li>通过允许<code>JNI</code>组件的<code>debug</code>和增加一个新的包名后缀来继续定制该<code>Build Type</code>。  </li>
</ul>
<p>不管使用<code>initWith()</code>还是使用其他的代码块，创建一个新的<code>Build Types</code>都是非常简单的在<code>buildTypes</code>代码块中创建一个新的元素就可以了。</p>
<p>#####签名配置</p>
<p>为应用签名需要使用如下几个部分:      </p>
<ul>
<li><code>A keystore</code></li>
<li><code>A keystore password</code></li>
<li><code>A key alias name</code></li>
<li><code>A key password</code></li>
<li><code>The store type</code></li>
</ul>
<p>默认情况下有一个<code>debug</code>的配置，设置了一个<code>debug</code>的<code>keystore</code>，有一个已知的密码。<code>debug keystore</code>的位置是在<code>$HOME/.android/debug.keystore</code>，如果没有的话他会被默认创建。<code>Debug</code>的<code>Build Type</code>会默认使用该<code>debug</code>的签名设置。</p>
<p>当然也可以通过使用<code>DSL</code>语法中的<code>signingconfigs</code>部分来创建其他的配置来进行定制:    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    signingConfigs &#123;</div><div class="line">        debug &#123;</div><div class="line">            storeFile file(&quot;debug.keystore&quot;)</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        myConfig &#123;</div><div class="line">            storeFile file(&quot;other.keystore&quot;)</div><div class="line">            storePassword &quot;android&quot;</div><div class="line">            keyAlias &quot;androiddebugkey&quot;</div><div class="line">            keyPassword &quot;android&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">        foo &#123;</div><div class="line">            signingConfig signingConfigs.myConfig</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的设置将把<code>debug keystore</code>的位置改为项目的根目录。同样也创建了一个新的签名配置，并且有一个新的<code>Build Type</code>使用它。</p>
<p>###<code>Dependencies, Android Libraries and Multi-project setup</code></p>
<p><code>Gradle</code>项目可以依赖其他的外部二进制包、或者其他的<code>Gradle</code>项目。</p>
<h5 id="本地包"><a href="#本地包" class="headerlink" title="本地包"></a>本地包</h5><p>想要配置依赖一个外部<code>jar</code>包，需要在<code>compile</code>的配置中添加一个<code>dependency</code>。下面的配置是添加了所有在<code>libs</code>目录的<code>jar</code>包:   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong><em>注意:</em></strong><code>DSL</code>元素中的<code>dependencies</code>是<code>Gradle API</code>中的标准元素。不属于<code>andorid</code>元素。<br><code>compile</code>配置是用来编译主应用的。它配置的所有部分都会被打包到<code>apk</code>中。当然也有一些其他的配置:      </p>
<ul>
<li><code>compile</code>: <code>main application</code></li>
<li><code>androidTestCompile</code>:<code>test application</code></li>
<li><code>debugCompile</code>:<code>debug Build Type</code></li>
<li><code>release Compile</code>:<code>release Build Type</code></li>
</ul>
<p>当然我们可以使用<code>compile</code>和<code>&lt;buildtype&gt;.compile</code>这两种配置。创建一个新的<code>Build Type</code>通常会自动基于它的名字创建一个新的配置部分。这样在像<code>debug</code>版本而<code>release</code>版本不适用的一些特别的<code>library</code>时非常有用。</p>
<p>#####远程仓库</p>
<p><code>Gradle</code>只是使用<code>Maven</code>和<code>Ivy</code>仓库。但是仓库必须要添加到列表中，并且必须声明所依赖仓库的<code>Maven</code>或者<code>Ivy</code>定义。      </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">repositories &#123;</div><div class="line">     jcenter()</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    compile &apos;com.google.guava:guava:18.0&apos;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong><em>注意: </em></strong><code>jcenter()</code>是指定仓库<code>URL</code>的快捷设置。<code>Gradle</code>支持远程和本地仓库。<br><strong><em>注意: </em></strong><code>Gradle</code>会直接识别所有的依赖关系。这就意味着如果一个依赖库自身又依赖别的库时，他们会被一起下下来。</p>
<p>#####本地<code>AAR</code>库     </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">	compile(name:&apos;本地aar库的名字，不用加后缀&apos;, ext:&apos;aar&apos;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>#####多项目设置      </p>
<p><code>Gradle</code>项目通常使用多项目设置来依赖其他的<code>gradle</code>项目。例如:      </p>
<ul>
<li>MyProject/         <ul>
<li>app/          </li>
<li>libraries/        <ul>
<li>lib1/           </li>
<li>lib2/     </li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>Gradle</code>会通过下面的名字来引用他们：<br><code>:app</code><br><code>:libraries:lib1</code><br><code>:libraries:lib2</code>      </p>
<p>每个项目都会有一个单独的<code>build</code>文件，并且在项目的根目录还会有一个<code>setting.gradle</code>文件：    </p>
<ul>
<li>MyProject/         <ul>
<li>settings.gradle         </li>
<li>app/      <ul>
<li>build.gradle       </li>
</ul>
</li>
</ul>
<ul>
<li>libraries/      <ul>
<li>lib1/       <ul>
<li>build.gradle      </li>
</ul>
</li>
<li>lib2/      <ul>
<li>build.gradle      </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>setting.gradle</code>文件中的内容非常简单。它指定了哪个目录是<code>Gralde</code>项目:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">include &apos;:app&apos;, &apos;:libraries:lib1&apos;, &apos;:libraries:lib2&apos;</div></pre></td></tr></table></figure></p>
<p><code>：app</code>这个项目可能会依赖其他的<code>libraries</code>，这样可以通过如下进行声明:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">     compile project(&apos;:libraries:lib1&apos;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###<code>Library</code>项目</p>
<p>上面用到了<code>:libraries:lib1</code>和<code>:libraries:lib2</code>可以是<code>Java</code>项目，<code>:app</code>项目会使用他们俩的输出的<code>jar</code>包。但是如果你需要使用<code>android</code>资源等，这些<code>libraries</code>就不能是普通的<code>Java</code>项目了，他们必须是<code>Android Library</code>项目。    </p>
<p>#####创建一个<code>Library</code>项目      </p>
<p><code>Library</code>项目和普通的<code>Android</code>项目的区别比较少，由于<code>libraries</code>的构建类型与应用程序的构建不同，所有它会使用一个别的构建插件。但是他们所使用的插件内部有很多相同的代码，他们都是由<code>com.android.tools.build.gradle</code>这个<code>jar</code>包提供的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    dependencies &#123;</div><div class="line">        classpath &apos;com.android.tools.build:gradle:1.3.1&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">apply plugin: &apos;com.android.library&apos;</div><div class="line"></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion 23</div><div class="line">    buildToolsVersion &quot;23.0.1&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>#####普通项目与<code>Library</code>项目的区别       </p>
<p><code>Library</code>项目的主要输出我<code>.aar</code>包。它结合了代码(例如<code>jar</code>包或者本地<code>.so</code>文件)和资源(<code>manifest</code>,<code>res</code>,<code>assets</code>)。每个<code>library</code>也可以单独设置<code>Build Type</code>等来指定生成不同版本的<code>aar</code>。</p>
<p>###<code>Lint Support</code></p>
<p>你可以通过指定对应的变量来设置<code>lint</code>的运行。可以通过添加<code>lintOptions</code>来进行配置:      </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    lintOptions &#123;</div><div class="line">        // turn off checking the given issue id&apos;s</div><div class="line">        disable &apos;TypographyFractions&apos;,&apos;TypographyQuotes&apos;</div><div class="line"></div><div class="line">        // turn on the given issue id&apos;s</div><div class="line">        enable &apos;RtlHardcoded&apos;,&apos;RtlCompat&apos;, &apos;RtlEnabled&apos;</div><div class="line"></div><div class="line">        // check *only* the given issue id&apos;s</div><div class="line">        check &apos;NewApi&apos;, &apos;InlinedApi&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###<code>Build</code>变量</p>
<p>构建系统的一个目标就是能对同一个应用创建多个不同的版本。    </p>
<p>#####<code>Product flavors</code>    </p>
<p>一个<code>product flavor</code>可以针对一个项目制定不同的构建版本。一个应用可以有多个不同的<code>falvors</code>来改变生成的应用。<br><code>Product flavors</code>是通过<code>DSL</code>语法中的<code>productFlavors</code>来声明的:    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ....</div><div class="line"></div><div class="line"></div><div class="line">    productFlavors &#123;</div><div class="line">        flavor1 &#123;</div><div class="line">            ...</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        flavor2 &#123;</div><div class="line">            ...</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>#####<code>Build Type + Product Flavor = Build Variant</code></p>
<p>像我们之前看到的，每个<code>Build Type</code>都会生成一个<code>apk</code>.<code>Product Flavors</code>也是同样的：项目的输出僵尸所有<code>Build Types</code>与<code>Product Flavors</code>的结合。每种结合方式称之为<code>Build Variant</code>。例如，如果有<code>debug</code>和<code>release</code>版本的<code>Build Types</code>，上面的例子就会生成4种<code>Build Variants</code>：    </p>
<ul>
<li><code>Flavor1</code> - <code>debug</code></li>
<li><code>Flavor1</code> - <code>release</code></li>
<li><code>Flavor2</code> - <code>debug</code></li>
<li><code>Flavor2</code> - <code>release</code></li>
</ul>
<p>没有配置<code>flavors</code>的项目仍然有<code>Build Variants</code>，它只是用了一个默认的<code>flavor/config</code>，没有名字，这导致<code>variants</code>的列表和<code>Build Types</code>的列表比较相同。</p>
<p>#####<code>Product Flavor</code>配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ...</div><div class="line"></div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        minSdkVersion 8</div><div class="line">        versionCode 10</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    productFlavors &#123;</div><div class="line">        flavor1 &#123;</div><div class="line">            applicationId &quot;com.example.flavor1&quot;</div><div class="line">            versionCode 20</div><div class="line">         &#125;</div><div class="line"></div><div class="line"></div><div class="line">         flavor2 &#123;</div><div class="line">             applicationId &quot;com.example.flavor2&quot;</div><div class="line">             minSdkVersion 14</div><div class="line">         &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意<code>android.productFlavors.*</code>对象<code>ProductFlavor</code>有<code>android.defaultConfig</code>是相同的类型。这就意味着他们有相同的属性。<br><code>defaultConfig</code>为所有的<code>flavors</code>提供了一些基本的配置，每个<code>flavor</code>都已重写他们。在上面的例子中，这些配置有:       </p>
<ul>
<li><code>flavor1</code>        <ul>
<li><code>applicationId</code>: <code>com.example.flavor1</code>      </li>
<li><code>minSdkVersion</code>: 8       </li>
<li><code>versionCode</code>: 20</li>
</ul>
</li>
<li><code>flavor2</code>    <ul>
<li><code>applicationId</code>: <code>com.example.flavor2</code>      </li>
<li><code>minSdkVersion</code>: 14       </li>
<li><code>versionCode</code>: 10       </li>
</ul>
</li>
</ul>
<p>通常，<code>Build Type</code>配置会覆盖其他的配置。例如，<code>Build Type</code>的<code>applicationIdSuffix</code>会添加到<code>Product Flavor</code>的<code>applicationId</code>上。</p>
<p>最后，就像<code>Build Types</code>一样，<code>Product Flavors</code>也可以有他们自己的依赖关系。例如，如果有一个单独的<code>flavors</code>会使用一些广告或者支付，那这个<code>flavors</code>生成的<code>apk</code>就会使用广告的依赖，而其他的<code>flavors</code>就不需要使用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    flavor1Compile &quot;...&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###<code>BuildConfig</code>      </p>
<p>在编译阶段，<code>Android Studio</code>会生成一个叫做<code>BuildConfig</code>的类，该类包含了编译时使用的一些变量的值。你可以观看这些值来改变不同变量的行为:       </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">private void javaCode() &#123;</div><div class="line">    if (BuildConfig.FLAVOR.equals(&quot;paidapp&quot;)) &#123;</div><div class="line">        doIt();</div><div class="line">    else &#123;</div><div class="line">        showOnlyInPaidAppDialog();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面是<code>BuildConfig</code>中包含的一些值:      </p>
<ul>
<li><code>boolean DEBUG</code> - <code>if the build is debuggable</code>      </li>
<li><code>int VERSION_CODE</code> </li>
<li><code>String VERSION_NAME</code></li>
<li><code>String APPLICATION_ID</code></li>
<li><code>String BUILD_TYPE</code>- <code>Build Type</code>的名字，例如<code>release</code>      </li>
<li><code>String FLAVOR</code> - <code>flavor</code>的名字，例如<code>flavor1</code>      </li>
</ul>
<p>###<code>ProGuard</code>配置      </p>
<p><code>Android</code>插件默认会使用<code>ProGuard</code>插件，并且如果<code>Build Type</code>中使用<code>ProGuard</code>的<code>minifyEnabled</code>属性开启的话，会默认创建对应的<code>task</code>。   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            minifyEnabled true</div><div class="line">            proguardFile getDefaultProguardFile(&apos;proguard-android.txt&apos;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    productFlavors &#123;</div><div class="line">        flavor1 &#123;</div><div class="line">        &#125;</div><div class="line">        flavor2 &#123;</div><div class="line">            proguardFile &apos;some-other-rules.txt&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###<code>Tasks</code>控制     </p>
<p>基本的<code>Java</code>项目有一系列的<code>tasks</code>一起制作输出文件。<br><code>classes task</code>就是编译<code>Java</code>源码的任务。 我们可以在<code>build.gradle</code>中通过使用<code>classes</code>很简单的获取到它。就是<code>project.tasks.classes</code>.    </p>
<p>在<code>Android</code>项目中，更多的编译<code>task</code>，因为他们的名字通过<code>Build Types</code>和<code>Product Flavors</code>生成。</p>
<p>为了解决这个问题，<code>android</code>对象有两种属性:     </p>
<ul>
<li><code>applicationVariants</code> - <code>only for the app plugin</code>     </li>
<li><code>libraryVariants</code> - <code>only for the library plugin</code>      </li>
<li><code>testVariants</code> - <code>for both plugins</code><br>这些都会返回一个<code>ApplicationVariant</code>, <code>LibraryVariant</code>,<code>TestVariant</code>的<code>DomainObjectCollection</code>接口的实现类对象。<br><code>DomainObjectCollection</code>提供了直接获取或者很方便的间接获取所有对象的方法。     <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">android.applicationVariants.all &#123; variant -&gt;</div><div class="line">   ....</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>###设置编译语言版本</p>
<p>可以使用<code>compileOptions</code>代码块来设置编译时使用的语言版本。默认是基于<code>compileSdkVersion</code>的值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    compileOptions &#123;</div><div class="line">        sourceCompatibility JavaVersion.VERSION_1_6</div><div class="line">        targetCompatibility JavaVersion.VERSION_1_6</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###<code>Resource Shrinking</code>    </p>
<p><code>Gradle</code>构建系统支持资源清理：对构建的应用会自动移除无用的资源。不仅会移除项目中未使用的资源，而且还会移除项目所以来的类库中的资源。注意，资源清理只能在与代码清理结合使用(例如<code>ProGuad</code>)。这就是为什么它能移除所依赖类库的无用资源。通常，类库中的所有资源都是使用的，只有类库中无用代码被移除后这些资源才会变成没有代码引用的无用资源。    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ...</div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            minifyEnabled true</div><div class="line">            shrinkResources true</div><div class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<ul>
<li>邮箱 ：itgoyo@gmail.com  </li>
<li>Good Luck! </li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">Android</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2015/01/01/Gradle专题/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 itgoyo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>
!function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="/",n(0)}([function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,n){var e=/\/|index.html/g;return t.replace(e,"")===n.replace(e,"")}function i(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,e=0,r=t.length;e<r;e++){var i=t[e];o(n,i.getAttribute("href"))&&(0,d.default)(i,"active")}}function u(t){for(var n=t.offsetLeft,e=t.offsetParent;null!==e;)n+=e.offsetLeft,e=e.offsetParent;return n}function f(t){for(var n=t.offsetTop,e=t.offsetParent;null!==e;)n+=e.offsetTop,e=e.offsetParent;return n}function c(t,n,e,r,o){var i=u(t),c=f(t)-n;if(c-e<=o){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,h.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(e||c)+"px",a.style.left=i+"px",a.style.zIndex=r||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");c(t,document.body.scrollTop,-63,2,0),c(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}function l(){x.default.versions.mobile&&window.screen.width<800&&(i(),s())}var p=e(71),d=r(p),v=e(72),y=(r(v),e(84)),h=r(y),b=e(69),x=r(b),m=e(75),g=r(m),w=e(70);l(),(0,w.addLoadEvent)(function(){g.default.init()}),t.exports={}},function(t,n){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t,n){var e={}.hasOwnProperty;t.exports=function(t,n){return e.call(t,n)}},function(t,n,e){var r=e(49),o=e(15);t.exports=function(t){return r(o(t))}},function(t,n,e){t.exports=!e(8)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,e){var r=e(6),o=e(12);t.exports=e(4)?function(t,n,e){return r.f(t,n,o(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n,e){var r=e(10),o=e(30),i=e(24),u=Object.defineProperty;n.f=e(4)?Object.defineProperty:function(t,n,e){if(r(t),n=i(n,!0),r(e),o)try{return u(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},function(t,n,e){var r=e(22)("wks"),o=e(13),i=e(1).Symbol,u="function"==typeof i,f=t.exports=function(t){return r[t]||(r[t]=u&&i[t]||(u?i:o)("Symbol."+t))};f.store=r},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){var r=e(35),o=e(16);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){var r=e(11);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var e=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+r).toString(36))}},function(t,n){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,e){var r=e(6).f,o=e(2),i=e(7)("toStringTag");t.exports=function(t,n,e){t&&!o(t=e?t:t.prototype,i)&&r(t,i,{configurable:!0,value:n})}},function(t,n,e){var r=e(22)("keys"),o=e(13);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,n,e){var r=e(1),o="__core-js_shared__",i=r[o]||(r[o]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)}},function(t,n,e){var r=e(11);t.exports=function(t,n){if(!r(t))return t;var e,o;if(n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;if("function"==typeof(e=t.valueOf)&&!r(o=e.call(t)))return o;if(!n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,n,e){var r=e(1),o=e(14),i=e(18),u=e(26),f=e(6).f;t.exports=function(t){var n=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==t.charAt(0)||t in n||f(n,t,{value:u.f(t)})}},function(t,n,e){n.f=e(7)},function(t,n,e){var r=e(1),o=e(14),i=e(46),u=e(5),f="prototype",c=function(t,n,e){var a,s,l,p=t&c.F,d=t&c.G,v=t&c.S,y=t&c.P,h=t&c.B,b=t&c.W,x=d?o:o[n]||(o[n]={}),m=x[f],g=d?r:v?r[n]:(r[n]||{})[f];d&&(e=n);for(a in e)s=!p&&g&&void 0!==g[a],s&&a in x||(l=s?g[a]:e[a],x[a]=d&&"function"!=typeof g[a]?e[a]:h&&s?i(l,r):b&&g[a]==l?function(t){var n=function(n,e,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,e)}return new t(n,e,r)}return t.apply(this,arguments)};return n[f]=t[f],n}(l):y&&"function"==typeof l?i(Function.call,l):l,y&&((x.virtual||(x.virtual={}))[a]=l,t&c.R&&m&&!m[a]&&u(m,a,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,n){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,n,e){var r=e(11),o=e(1).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,n,e){t.exports=!e(4)&&!e(8)(function(){return 7!=Object.defineProperty(e(29)("div"),"a",{get:function(){return 7}}).a})},function(t,n,e){"use strict";var r=e(18),o=e(27),i=e(36),u=e(5),f=e(2),c=e(17),a=e(51),s=e(20),l=e(58),p=e(7)("iterator"),d=!([].keys&&"next"in[].keys()),v="@@iterator",y="keys",h="values",b=function(){return this};t.exports=function(t,n,e,x,m,g,w){a(e,n,x);var O,S,_,j=function(t){if(!d&&t in A)return A[t];switch(t){case y:return function(){return new e(this,t)};case h:return function(){return new e(this,t)}}return function(){return new e(this,t)}},P=n+" Iterator",E=m==h,M=!1,A=t.prototype,T=A[p]||A[v]||m&&A[m],L=T||j(m),N=m?E?j("entries"):L:void 0,C="Array"==n?A.entries||T:T;if(C&&(_=l(C.call(new t)),_!==Object.prototype&&(s(_,P,!0),r||f(_,p)||u(_,p,b))),E&&T&&T.name!==h&&(M=!0,L=function(){return T.call(this)}),r&&!w||!d&&!M&&A[p]||u(A,p,L),c[n]=L,c[P]=b,m)if(O={values:E?L:j(h),keys:g?L:j(y),entries:N},w)for(S in O)S in A||i(A,S,O[S]);else o(o.P+o.F*(d||M),n,O);return O}},function(t,n,e){var r=e(10),o=e(55),i=e(16),u=e(21)("IE_PROTO"),f=function(){},c="prototype",a=function(){var t,n=e(29)("iframe"),r=i.length,o="<",u=">";for(n.style.display="none",e(48).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(o+"script"+u+"document.F=Object"+o+"/script"+u),t.close(),a=t.F;r--;)delete a[c][i[r]];return a()};t.exports=Object.create||function(t,n){var e;return null!==t?(f[c]=r(t),e=new f,f[c]=null,e[u]=t):e=a(),void 0===n?e:o(e,n)}},function(t,n,e){var r=e(35),o=e(16).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,e){var r=e(2),o=e(3),i=e(45)(!1),u=e(21)("IE_PROTO");t.exports=function(t,n){var e,f=o(t),c=0,a=[];for(e in f)e!=u&&r(f,e)&&a.push(e);for(;n.length>c;)r(f,e=n[c++])&&(~i(a,e)||a.push(e));return a}},function(t,n,e){t.exports=e(5)},function(t,n,e){var r=e(15);t.exports=function(t){return Object(r(t))}},function(t,n,e){t.exports={default:e(41),__esModule:!0}},function(t,n,e){t.exports={default:e(42),__esModule:!0}},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var o=e(39),i=r(o),u=e(38),f=r(u),c="function"==typeof f.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":typeof t};n.default="function"==typeof f.default&&"symbol"===c(i.default)?function(t){return"undefined"==typeof t?"undefined":c(t)}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":"undefined"==typeof t?"undefined":c(t)}},function(t,n,e){e(65),e(63),e(66),e(67),t.exports=e(14).Symbol},function(t,n,e){e(64),e(68),t.exports=e(26).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,e){var r=e(3),o=e(61),i=e(60);t.exports=function(t){return function(n,e,u){var f,c=r(n),a=o(c.length),s=i(u,a);if(t&&e!=e){for(;a>s;)if(f=c[s++],f!=f)return!0}else for(;a>s;s++)if((t||s in c)&&c[s]===e)return t||s||0;return!t&&-1}}},function(t,n,e){var r=e(43);t.exports=function(t,n,e){if(r(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)}}return function(){return t.apply(n,arguments)}}},function(t,n,e){var r=e(9),o=e(34),i=e(19);t.exports=function(t){var n=r(t),e=o.f;if(e)for(var u,f=e(t),c=i.f,a=0;f.length>a;)c.call(t,u=f[a++])&&n.push(u);return n}},function(t,n,e){t.exports=e(1).document&&document.documentElement},function(t,n,e){var r=e(28);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,n,e){var r=e(28);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){"use strict";var r=e(32),o=e(12),i=e(20),u={};e(5)(u,e(7)("iterator"),function(){return this}),t.exports=function(t,n,e){t.prototype=r(u,{next:o(1,e)}),i(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,e){var r=e(9),o=e(3);t.exports=function(t,n){for(var e,i=o(t),u=r(i),f=u.length,c=0;f>c;)if(i[e=u[c++]]===n)return e}},function(t,n,e){var r=e(13)("meta"),o=e(11),i=e(2),u=e(6).f,f=0,c=Object.isExtensible||function(){return!0},a=!e(8)(function(){return c(Object.preventExtensions({}))}),s=function(t){u(t,r,{value:{i:"O"+ ++f,w:{}}})},l=function(t,n){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,r)){if(!c(t))return"F";if(!n)return"E";s(t)}return t[r].i},p=function(t,n){if(!i(t,r)){if(!c(t))return!0;if(!n)return!1;s(t)}return t[r].w},d=function(t){return a&&v.NEED&&c(t)&&!i(t,r)&&s(t),t},v=t.exports={KEY:r,NEED:!1,fastKey:l,getWeak:p,onFreeze:d}},function(t,n,e){var r=e(6),o=e(10),i=e(9);t.exports=e(4)?Object.defineProperties:function(t,n){o(t);for(var e,u=i(n),f=u.length,c=0;f>c;)r.f(t,e=u[c++],n[e]);return t}},function(t,n,e){var r=e(19),o=e(12),i=e(3),u=e(24),f=e(2),c=e(30),a=Object.getOwnPropertyDescriptor;n.f=e(4)?a:function(t,n){if(t=i(t),n=u(n,!0),c)try{return a(t,n)}catch(t){}if(f(t,n))return o(!r.f.call(t,n),t[n])}},function(t,n,e){var r=e(3),o=e(33).f,i={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],f=function(t){try{return o(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==i.call(t)?f(t):o(r(t))}},function(t,n,e){var r=e(2),o=e(37),i=e(21)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,e){var r=e(23),o=e(15);t.exports=function(t){return function(n,e){var i,u,f=String(o(n)),c=r(e),a=f.length;return c<0||c>=a?t?"":void 0:(i=f.charCodeAt(c),i<55296||i>56319||c+1===a||(u=f.charCodeAt(c+1))<56320||u>57343?t?f.charAt(c):i:t?f.slice(c,c+2):(i-55296<<10)+(u-56320)+65536)}}},function(t,n,e){var r=e(23),o=Math.max,i=Math.min;t.exports=function(t,n){return t=r(t),t<0?o(t+n,0):i(t,n)}},function(t,n,e){var r=e(23),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){"use strict";var r=e(44),o=e(52),i=e(17),u=e(3);t.exports=e(31)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,o(1)):"keys"==n?o(0,e):"values"==n?o(0,t[e]):o(0,[e,t[e]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(t,n){},function(t,n,e){"use strict";var r=e(59)(!0);e(31)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=r(n,e),this._i+=t.length,{value:t,done:!1})})},function(t,n,e){"use strict";var r=e(1),o=e(2),i=e(4),u=e(27),f=e(36),c=e(54).KEY,a=e(8),s=e(22),l=e(20),p=e(13),d=e(7),v=e(26),y=e(25),h=e(53),b=e(47),x=e(50),m=e(10),g=e(3),w=e(24),O=e(12),S=e(32),_=e(57),j=e(56),P=e(6),E=e(9),M=j.f,A=P.f,T=_.f,L=r.Symbol,N=r.JSON,C=N&&N.stringify,k="prototype",F=d("_hidden"),q=d("toPrimitive"),I={}.propertyIsEnumerable,B=s("symbol-registry"),D=s("symbols"),W=s("op-symbols"),H=Object[k],K="function"==typeof L,R=r.QObject,J=!R||!R[k]||!R[k].findChild,U=i&&a(function(){return 7!=S(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(t,n,e){var r=M(H,n);r&&delete H[n],A(t,n,e),r&&t!==H&&A(H,n,r)}:A,G=function(t){var n=D[t]=S(L[k]);return n._k=t,n},$=K&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},z=function(t,n,e){return t===H&&z(W,n,e),m(t),n=w(n,!0),m(e),o(D,n)?(e.enumerable?(o(t,F)&&t[F][n]&&(t[F][n]=!1),e=S(e,{enumerable:O(0,!1)})):(o(t,F)||A(t,F,O(1,{})),t[F][n]=!0),U(t,n,e)):A(t,n,e)},Y=function(t,n){m(t);for(var e,r=b(n=g(n)),o=0,i=r.length;i>o;)z(t,e=r[o++],n[e]);return t},Q=function(t,n){return void 0===n?S(t):Y(S(t),n)},X=function(t){var n=I.call(this,t=w(t,!0));return!(this===H&&o(D,t)&&!o(W,t))&&(!(n||!o(this,t)||!o(D,t)||o(this,F)&&this[F][t])||n)},V=function(t,n){if(t=g(t),n=w(n,!0),t!==H||!o(D,n)||o(W,n)){var e=M(t,n);return!e||!o(D,n)||o(t,F)&&t[F][n]||(e.enumerable=!0),e}},Z=function(t){for(var n,e=T(g(t)),r=[],i=0;e.length>i;)o(D,n=e[i++])||n==F||n==c||r.push(n);return r},tt=function(t){for(var n,e=t===H,r=T(e?W:g(t)),i=[],u=0;r.length>u;)!o(D,n=r[u++])||e&&!o(H,n)||i.push(D[n]);return i};K||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=p(arguments.length>0?arguments[0]:void 0),n=function(e){this===H&&n.call(W,e),o(this,F)&&o(this[F],t)&&(this[F][t]=!1),U(this,t,O(1,e))};return i&&J&&U(H,t,{configurable:!0,set:n}),G(t)},f(L[k],"toString",function(){return this._k}),j.f=V,P.f=z,e(33).f=_.f=Z,e(19).f=X,e(34).f=tt,i&&!e(18)&&f(H,"propertyIsEnumerable",X,!0),v.f=function(t){return G(d(t))}),u(u.G+u.W+u.F*!K,{Symbol:L});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;nt.length>et;)d(nt[et++]);for(var nt=E(d.store),et=0;nt.length>et;)y(nt[et++]);u(u.S+u.F*!K,"Symbol",{for:function(t){return o(B,t+="")?B[t]:B[t]=L(t)},keyFor:function(t){if($(t))return h(B,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){J=!0},useSimple:function(){J=!1}}),u(u.S+u.F*!K,"Object",{create:Q,defineProperty:z,defineProperties:Y,getOwnPropertyDescriptor:V,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),N&&u(u.S+u.F*(!K||a(function(){var t=L();return"[null]"!=C([t])||"{}"!=C({a:t})||"{}"!=C(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!$(t)){for(var n,e,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);return n=r[1],"function"==typeof n&&(e=n),!e&&x(n)||(n=function(t,n){if(e&&(n=e.call(this,t,n)),!$(n))return n}),r[1]=n,C.apply(N,r)}}}),L[k][q]||e(5)(L[k],q,L[k].valueOf),l(L,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},function(t,n,e){e(25)("asyncIterator")},function(t,n,e){e(25)("observable")},function(t,n,e){e(62);for(var r=e(1),o=e(5),i=e(17),u=e(7)("toStringTag"),f=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var a=f[c],s=r[a],l=s&&s.prototype;l&&!l[u]&&o(l,u,a),i[a]=i.Array}},function(t,n){"use strict";var e={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")==-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")==-1,weixin:t.indexOf("MicroMessenger")==-1}}()};t.exports=e},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=e(40),i=r(o),u=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):o[t]||t}function n(t){return l[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,r=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},f=/\u00a0/g,c=/<br\s*\/?>/gi,a=/\r?\n/g,s=/\s/g,l={};for(var p in o)l[o[p]]=p;return o["&apos;"]="'",l["'"]="&#39;",{encode:function(t){return t?(""+t).replace(r,n).replace(a,"<br/>").replace(s,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(c,"\n").replace(e,t).replace(f," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e+=2)n.push(String.fromCharCode("0x"+t.slice(e,e+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,e=t.length;e>n;n++)t[n]=u.encodeObject(t[n]);else if("object"==("undefined"==typeof t?"undefined":(0,i.default)(t)))for(var r in t)t[r]=u.encodeObject(t[r]);else if("string"==typeof t)return u.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=u},function(t,n){function e(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=e},function(t,n){function e(t,n){if(t.classList)t.classList.remove(n);else{var e=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(e," ")}}t.exports=e},,,function(t,n){"use strict";function e(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){var n=document.querySelectorAll(".article-entry a:not(.article-more-a)");n.forEach(function(t){t.setAttribute("target","_blank")})}var e=document.querySelector("#js-aboutme");e&&0!==e.length&&(e.innerHTML=e.innerText)}t.exports={init:e}},,,,,,,,,function(t,n){function e(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var e=t.nextSibling;return e?t.parentNode.insertBefore(n,e):t.parentNode.appendChild(n)}t.exports=e}]);
</script>
<script src="/main.d221b8.js"></script>
<script>
(function() {
	var loadScript = function(path) {
	    var $script = document.createElement('script')
	    document.getElementsByTagName('body')[0].appendChild($script)
	    $script.setAttribute('src', path)
	}
	loadScript("/slider.59dfdc.js")
})();
</script>




    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Android</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Github</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">Hexo</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">Java</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            2、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: true
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">itgoyo&lt;br&gt;&lt;br&gt;毕业于桂电&lt;br&gt;就业于中兴&lt;br&gt;&lt;br&gt;&lt;br&gt;穷困潦倒&lt;br&gt;卖码为生</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>